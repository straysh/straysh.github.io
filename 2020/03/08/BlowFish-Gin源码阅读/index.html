<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- å¼ºåˆ¶é¡µé¢åœ¨å½“å‰çª—å£ä»¥ç‹¬ç«‹é¡µé¢æ˜¾ç¤º,é˜²æ­¢åˆ«äººåœ¨æ¡†æ¶é‡Œè°ƒç”¨é¡µé¢ -->
  <meta http-equiv="window-target" content="_top" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" />
  
  
  <title>BlowFish_Ginæºç é˜…è¯» | Hexo</title>
  <meta name="description" content="æŒç»­æ•´ç†ä¸­ï¼Œä¸é€‚åˆé˜…è¯» GINç‰ˆæœ¬ commithash a71af9c144f9579f6dbe945341c1df37aaf09c0dGinæ¡†æ¶çš„ç‰¹ç‚¹ å¿«ï¼šè·¯ç”±ä½¿ç”¨radix trieå®ç°ï¼Œæ£€ç´¢è·¯å¾„çŸ­ã€‚æ— åå°„ã€‚APIæ€§èƒ½å¯é¢„æµ‹ã€‚ æ”¯æŒä¸­é—´ä»¶ï¼šè¯·æ±‚å¯ä»¥æœ‰å¤šä¸ªä¸­é—´ä»¶é€ä¸ªå¤„ç†ï¼Œæœ€åäº¤ç»™ä¸šåŠ¡å¤„ç†ã€‚ä¾‹å¦‚ï¼šLogger,Authorization,GZIP,æœ€åå†™å…¥æ•°æ®åº“ã€‚ è‹¥å‘ç”Ÿäº†panicï¼ŒGinå¯ä»¥">
<meta property="og:type" content="article">
<meta property="og:title" content="BlowFish_Ginæºç é˜…è¯»">
<meta property="og:url" content="https://straysh.github.life/2020/03/08/BlowFish-Gin%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/index.html">
<meta property="og:site_name" content="Strayshçš„å°é™¢">
<meta property="og:description" content="æŒç»­æ•´ç†ä¸­ï¼Œä¸é€‚åˆé˜…è¯» GINç‰ˆæœ¬ commithash a71af9c144f9579f6dbe945341c1df37aaf09c0dGinæ¡†æ¶çš„ç‰¹ç‚¹ å¿«ï¼šè·¯ç”±ä½¿ç”¨radix trieå®ç°ï¼Œæ£€ç´¢è·¯å¾„çŸ­ã€‚æ— åå°„ã€‚APIæ€§èƒ½å¯é¢„æµ‹ã€‚ æ”¯æŒä¸­é—´ä»¶ï¼šè¯·æ±‚å¯ä»¥æœ‰å¤šä¸ªä¸­é—´ä»¶é€ä¸ªå¤„ç†ï¼Œæœ€åäº¤ç»™ä¸šåŠ¡å¤„ç†ã€‚ä¾‹å¦‚ï¼šLogger,Authorization,GZIP,æœ€åå†™å…¥æ•°æ®åº“ã€‚ è‹¥å‘ç”Ÿäº†panicï¼ŒGinå¯ä»¥">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://straysh.github.life/images/golang/gin/gin_Engine_methods.png">
<meta property="og:image" content="https://straysh.github.life/images/golang/gin/engine_handleHTTPRequest.png">
<meta property="og:image" content="https://straysh.github.life/images/golang/gin/gin_Route_Next.png">
<meta property="og:image" content="https://straysh.github.life/images/golang/gin/Trie_example.svg">
<meta property="og:image" content="https://straysh.github.life/images/golang/gin/trie_example_001.png">
<meta property="article:published_time" content="2020-03-08T10:34:40.000Z">
<meta property="article:modified_time" content="2020-03-12T15:30:34.398Z">
<meta property="article:author" content="Straysh">
<meta property="article:tag" content="Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://straysh.github.life/images/golang/gin/gin_Engine_methods.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://straysh.github.life/2020/03/08/BlowFish-Gin%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Strayshçš„å°é™¢" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
  
  
    <link href="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
  
  
<meta name="generator" content="Hexo 5.4.1"></head>


<body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" style="background-image: url(/images/left_images/2.jpg);" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent" style="height:100%;background-color: rgba(0,0,0,0.7);">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://hexo.straysh.com" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Straysh</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">é‡ç”Ÿç¨‹åºçŒ¿</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="æœç´¢" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">é¦–é¡µ</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">å½’æ¡£</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">åˆ†ç±»</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">æ ‡ç­¾</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">é¡¹ç›®</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">ä¹¦å•</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">å‹é“¾</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">å…³äº</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/straysh" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://weibo.com/u/1689171115" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">

    
      <ul class="sidebar-nav motion-element" style="text-align:center; opacity: 1; display: block; transform: translateX(0px);">
        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview-wrap">
          ç³»ç»Ÿç›®å½•
        </li>
      </ul>
      <section class="site-overview-wrap sidebar-panel" style="opacity: 0; display: none;">
        
          <div class="widget">
    <h3 class="widget-title">å…¬å‘Š</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>å¦³æ˜¯é£ä¸­çš„å¶ï¼Œé£èµ·è€Œèµ°ï¼Œæˆ‘æƒ³å»è¿½ï¼Œæ€ä¹ˆæŠ“çš„ä½ï¼Ÿ</p>
            </div>
        </div>
    </div>
</div>

        
          
  <div class="widget">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E6%96%87/">åšæ–‡</a><span class="category-list-count">103</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%AE%B0/">æ‚è®°</a><span class="category-list-count">6</span></li></ul>
    </div>
  </div>


        
          
  <div class="widget">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/" rel="tag">Apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Banbrick/" rel="tag">Banbrick</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/R/" rel="tag">R</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVN/" rel="tag">SVN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sphinx/" rel="tag">Sphinx</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translation/" rel="tag">Translation</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yii/" rel="tag">Yii</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">æ‚</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B1%87%E7%BC%96/" rel="tag">æ±‡ç¼–</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


        
          
  <div class="widget">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 13.67px;">Algorithm</a> <a href="/tags/Apache/" style="font-size: 13px;">Apache</a> <a href="/tags/Banbrick/" style="font-size: 13.33px;">Banbrick</a> <a href="/tags/Docker/" style="font-size: 13.22px;">Docker</a> <a href="/tags/Golang/" style="font-size: 14px;">Golang</a> <a href="/tags/Javascript/" style="font-size: 13.56px;">Javascript</a> <a href="/tags/Kafka/" style="font-size: 13px;">Kafka</a> <a href="/tags/Linux/" style="font-size: 13.78px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 13.67px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 13px;">Mysql</a> <a href="/tags/Nginx/" style="font-size: 13.11px;">Nginx</a> <a href="/tags/Nodejs/" style="font-size: 13px;">Nodejs</a> <a href="/tags/PHP/" style="font-size: 13.89px;">PHP</a> <a href="/tags/R/" style="font-size: 13.11px;">R</a> <a href="/tags/Redis/" style="font-size: 13.11px;">Redis</a> <a href="/tags/SVN/" style="font-size: 13px;">SVN</a> <a href="/tags/Sphinx/" style="font-size: 13.33px;">Sphinx</a> <a href="/tags/Translation/" style="font-size: 13.89px;">Translation</a> <a href="/tags/Yii/" style="font-size: 13.11px;">Yii</a> <a href="/tags/%E6%9D%82/" style="font-size: 13.44px;">æ‚</a> <a href="/tags/%E6%B1%87%E7%BC%96/" style="font-size: 13px;">æ±‡ç¼–</a>
    </div>
  </div>

        
          
  <div class="widget">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">åä¸€æœˆ 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">ä¸‰æœˆ 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">ä¸‰æœˆ 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">ä¸‰æœˆ 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">äºŒæœˆ 2020</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">åäºŒæœˆ 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">å››æœˆ 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">ä¹æœˆ 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">ä¸ƒæœˆ 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">å…­æœˆ 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">åä¸€æœˆ 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">åæœˆ 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">ä¹æœˆ 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">å…«æœˆ 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">ä¸ƒæœˆ 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">åä¸€æœˆ 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">ä¸‰æœˆ 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">åäºŒæœˆ 2013</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">åæœˆ 2013</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">ä¹æœˆ 2013</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


        
          
  <div class="widget">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">åšæ–‡</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/" class="title">kafkaåŸç†åŠç›‘æ§æŒ‡æ ‡</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-28T04:36:07.000Z" itemprop="datePublished">2022-11-28</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">åšæ–‡</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/14/%E4%BD%BF%E7%94%A8Go%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6/" class="title">ä½¿ç”¨Goæ“ä½œæ–‡ä»¶</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-14T12:11:25.000Z" itemprop="datePublished">2022-03-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">åšæ–‡</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/13/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C/" class="title">Dockerå®¹å™¨ç½‘ç»œ</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-13T04:10:09.000Z" itemprop="datePublished">2022-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">åšæ–‡</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/13/Iptables%E5%92%8C%E5%AE%B9%E5%99%A8/" class="title">Iptableså’Œå®¹å™¨</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-13T03:01:46.000Z" itemprop="datePublished">2022-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">åšæ–‡</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/12/Linux%E7%BD%91%E6%A1%A5%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" class="title">Linuxç½‘æ¡¥å·¥ä½œåŸç†</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-12T10:02:29.000Z" itemprop="datePublished">2022-03-12</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

        
      </section>

      <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active" style="opacity: 1; display: block;">
        <nav id="toc" class="article-toc">
          <h3 class="toc-title">æ–‡ç« ç›®å½•</h3>
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GIN%E7%89%88%E6%9C%AC-commithash-a71af9c144f9579f6dbe945341c1df37aaf09c0d"><span class="toc-number">1.</span> <span class="toc-text">GINç‰ˆæœ¬ commithash a71af9c144f9579f6dbe945341c1df37aaf09c0d</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">Ginæ¡†æ¶çš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB"><span class="toc-number">3.</span> <span class="toc-text">æºä»£ç é˜…è¯»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8"><span class="toc-number">3.1.</span> <span class="toc-text">æœåŠ¡å¯åŠ¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket-Server-VS-HTTP-Server"><span class="toc-number">3.1.1.</span> <span class="toc-text">Socket Server VS HTTP Server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gin%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">3.2.</span> <span class="toc-text">Ginçš„å¯åŠ¨è¿‡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">4.</span> <span class="toc-text">è·¯ç”±</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Trie"><span class="toc-number">4.1.</span> <span class="toc-text">Trie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#trie%E9%80%9A%E5%B8%B8%E7%94%A8%E6%9D%A5%E5%8F%96%E4%BB%A3hash-table%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%9C%89%E5%A6%82%E4%B8%8B%E4%BC%98%E5%8A%BF%EF%BC%9A"><span class="toc-number">4.1.1.</span> <span class="toc-text">trieé€šå¸¸ç”¨æ¥å–ä»£hash tableï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%86%E5%90%8C%E6%97%B6%EF%BC%8C%E7%9B%B8%E5%AF%B9%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8Ctrie%E6%9C%89%E5%A6%82%E4%B8%8B%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="toc-number">4.1.2.</span> <span class="toc-text">ä½†åŒæ—¶ï¼Œç›¸å¯¹å“ˆå¸Œè¡¨ï¼Œtrieæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Radix-Tree"><span class="toc-number">4.2.</span> <span class="toc-text">Radix Tree</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">è§£æè¯·æ±‚å‚æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93JSON"><span class="toc-number">6.</span> <span class="toc-text">æ¸²æŸ“JSON</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#session-amp-cookie"><span class="toc-number">7.</span> <span class="toc-text">session &amp; cookie</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#URL%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">8.</span> <span class="toc-text">URLé‡å®šå‘</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#goroutin-inside-a-middleware"><span class="toc-number">9.</span> <span class="toc-text">goroutin inside a middleware</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97"><span class="toc-number">10.</span> <span class="toc-text">æ—¥å¿—æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#debug%E6%97%A5%E5%BF%97"><span class="toc-number">10.1.</span> <span class="toc-text">debugæ—¥å¿—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%97%A5%E5%BF%97"><span class="toc-number">10.2.</span> <span class="toc-text">è·¯ç”±æ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Build-a-single-binary-with-templates"><span class="toc-number">11.</span> <span class="toc-text">Build a single binary with templates</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http2-server-push"><span class="toc-number">12.</span> <span class="toc-text">http2 server push</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go%E6%9C%8D%E5%8A%A1%E8%A6%81%E4%B8%8D%E8%A6%81%E9%85%8Dnginx%E5%89%8D%E7%AB%AF"><span class="toc-number">13.</span> <span class="toc-text">goæœåŠ¡è¦ä¸è¦é…nginxå‰ç«¯</span></a></li></ol>
        </nav>
      </section>
    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">æ–‡ç« ç›®å½•</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GIN%E7%89%88%E6%9C%AC-commithash-a71af9c144f9579f6dbe945341c1df37aaf09c0d"><span class="toc-number">1.</span> <span class="toc-text">GINç‰ˆæœ¬ commithash a71af9c144f9579f6dbe945341c1df37aaf09c0d</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gin%E6%A1%86%E6%9E%B6%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">Ginæ¡†æ¶çš„ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB"><span class="toc-number">3.</span> <span class="toc-text">æºä»£ç é˜…è¯»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8"><span class="toc-number">3.1.</span> <span class="toc-text">æœåŠ¡å¯åŠ¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket-Server-VS-HTTP-Server"><span class="toc-number">3.1.1.</span> <span class="toc-text">Socket Server VS HTTP Server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gin%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">3.2.</span> <span class="toc-text">Ginçš„å¯åŠ¨è¿‡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">4.</span> <span class="toc-text">è·¯ç”±</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Trie"><span class="toc-number">4.1.</span> <span class="toc-text">Trie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#trie%E9%80%9A%E5%B8%B8%E7%94%A8%E6%9D%A5%E5%8F%96%E4%BB%A3hash-table%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%9C%89%E5%A6%82%E4%B8%8B%E4%BC%98%E5%8A%BF%EF%BC%9A"><span class="toc-number">4.1.1.</span> <span class="toc-text">trieé€šå¸¸ç”¨æ¥å–ä»£hash tableï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%86%E5%90%8C%E6%97%B6%EF%BC%8C%E7%9B%B8%E5%AF%B9%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8Ctrie%E6%9C%89%E5%A6%82%E4%B8%8B%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="toc-number">4.1.2.</span> <span class="toc-text">ä½†åŒæ—¶ï¼Œç›¸å¯¹å“ˆå¸Œè¡¨ï¼Œtrieæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Radix-Tree"><span class="toc-number">4.2.</span> <span class="toc-text">Radix Tree</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">è§£æè¯·æ±‚å‚æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93JSON"><span class="toc-number">6.</span> <span class="toc-text">æ¸²æŸ“JSON</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#session-amp-cookie"><span class="toc-number">7.</span> <span class="toc-text">session &amp; cookie</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#URL%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">8.</span> <span class="toc-text">URLé‡å®šå‘</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#goroutin-inside-a-middleware"><span class="toc-number">9.</span> <span class="toc-text">goroutin inside a middleware</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97"><span class="toc-number">10.</span> <span class="toc-text">æ—¥å¿—æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#debug%E6%97%A5%E5%BF%97"><span class="toc-number">10.1.</span> <span class="toc-text">debugæ—¥å¿—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%97%A5%E5%BF%97"><span class="toc-number">10.2.</span> <span class="toc-text">è·¯ç”±æ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Build-a-single-binary-with-templates"><span class="toc-number">11.</span> <span class="toc-text">Build a single binary with templates</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#http2-server-push"><span class="toc-number">12.</span> <span class="toc-text">http2 server push</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#go%E6%9C%8D%E5%8A%A1%E8%A6%81%E4%B8%8D%E8%A6%81%E9%85%8Dnginx%E5%89%8D%E7%AB%AF"><span class="toc-number">13.</span> <span class="toc-text">goæœåŠ¡è¦ä¸è¦é…nginxå‰ç«¯</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-BlowFish-Ginæºç é˜…è¯»" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      BlowFish_Ginæºç é˜…è¯»
    </h1>
  


      
      <div class="article-meta">
        
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2020/03/08/BlowFish-Gin%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" class="article-date">
	  <time datetime="2020-03-08T10:34:40.000Z" itemprop="datePublished">2020-03-08</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E5%8D%9A%E6%96%87/">åšæ–‡</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/Golang/" rel="tag">Golang</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/03/08/BlowFish-Gin%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/#comments" class="article-comment-link">è¯„è®º</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>æŒç»­æ•´ç†ä¸­ï¼Œä¸é€‚åˆé˜…è¯»</p>
<h1 id="GINç‰ˆæœ¬-commithash-a71af9c144f9579f6dbe945341c1df37aaf09c0d"><a href="#GINç‰ˆæœ¬-commithash-a71af9c144f9579f6dbe945341c1df37aaf09c0d" class="headerlink" title="GINç‰ˆæœ¬ commithash a71af9c144f9579f6dbe945341c1df37aaf09c0d"></a>GINç‰ˆæœ¬ commithash a71af9c144f9579f6dbe945341c1df37aaf09c0d</h1><h1 id="Ginæ¡†æ¶çš„ç‰¹ç‚¹"><a href="#Ginæ¡†æ¶çš„ç‰¹ç‚¹" class="headerlink" title="Ginæ¡†æ¶çš„ç‰¹ç‚¹"></a>Ginæ¡†æ¶çš„ç‰¹ç‚¹</h1><ul>
<li>å¿«ï¼šè·¯ç”±ä½¿ç”¨<code>radix trie</code>å®ç°ï¼Œæ£€ç´¢è·¯å¾„çŸ­ã€‚æ— åå°„ã€‚APIæ€§èƒ½å¯é¢„æµ‹ã€‚</li>
<li>æ”¯æŒä¸­é—´ä»¶ï¼šè¯·æ±‚å¯ä»¥æœ‰å¤šä¸ªä¸­é—´ä»¶é€ä¸ªå¤„ç†ï¼Œæœ€åäº¤ç»™ä¸šåŠ¡å¤„ç†ã€‚ä¾‹å¦‚ï¼š<code>Logger</code>,<code>Authorization</code>,<code>GZIP</code>,æœ€åå†™å…¥æ•°æ®åº“ã€‚</li>
<li>è‹¥å‘ç”Ÿäº†<code>panic</code>ï¼ŒGinå¯ä»¥æ•è·å¹¶æ¢å¤é”™è¯¯ï¼Œå› æ­¤æœåŠ¡å¹¶ä¸ä¼šç»ˆæ­¢ï¼Œä¸”å¯æœ‰æœºä¼šä»‹å…¥é”™è¯¯æ¢å¤çš„è¿‡ç¨‹ã€‚</li>
<li>JSONæ ¡éªŒï¼šGinå¯ä»¥è§£æå¹¶æ ¡éªŒè¯·æ±‚çš„jsonæ•°æ®ï¼Œä¾‹å¦‚æ£€æŸ¥å­—æ®µå€¼ã€‚</li>
<li>è·¯ç”±åˆ†ç»„ï¼šæ›´å¥½çš„ç»„ç»‡è·¯ç”±ã€‚é€šè¿‡åˆ†ç»„å°†éœ€è¦é‰´æƒå’Œä¸éœ€é‰´æƒçš„è·¯ç”±åˆ†å¼€ï¼Œåˆ†ç»„å¯ä»¥æ— é™åµŒå¥—ä¸”ä¸å½±å“æ€§èƒ½ã€‚</li>
<li>é”™è¯¯ç®¡ç†ï¼šGinå¯ä»¥å’Œå¾ˆæ–¹ä¾¿çš„æ”¶é›†é”™è¯¯ä¿¡æ¯ã€‚æœ€åä½¿ç”¨ä¸­é—´ä»¶å°†é”™è¯¯å†™å…¥æ–‡ä»¶æˆ–æ•°æ®åº“æˆ–å‘é€åˆ°ç½‘ç»œä¸Šã€‚</li>
<li>å†…ç½®è§†å›¾æ¸²æŸ“ï¼šæä¾›äº†æ˜“ç”¨çš„æ¥å£æ¥æ¸²æŸ“<code>JSON</code>ï¼Œ<code>XML</code>å’Œ<code>HTML</code>ã€‚</li>
<li>å¯æ‰©å±•ï¼šè‡ªå®šä¹‰ä¸­é—´ä»¶éå¸¸å®¹æ˜“ã€‚</li>
</ul>
<h1 id="æºä»£ç é˜…è¯»"><a href="#æºä»£ç é˜…è¯»" class="headerlink" title="æºä»£ç é˜…è¯»"></a>æºä»£ç é˜…è¯»</h1><h2 id="æœåŠ¡å¯åŠ¨"><a href="#æœåŠ¡å¯åŠ¨" class="headerlink" title="æœåŠ¡å¯åŠ¨"></a>æœåŠ¡å¯åŠ¨</h2><h3 id="Socket-Server-VS-HTTP-Server"><a href="#Socket-Server-VS-HTTP-Server" class="headerlink" title="Socket Server VS HTTP Server"></a>Socket Server VS HTTP Server</h3><p>HTTPæ˜¯<a href="/2020/02/27/%E7%BD%91%E7%BB%9C-tcp-udp/#TCP-UDP%E5%B7%A5%E4%BD%9C%E5%9C%A8%E4%BC%A0%E8%BE%93%E5%B1%82">åº”ç”¨å±‚åè®®</a>ï¼›Socketæ˜¯ç³»ç»Ÿæä¾›çš„æŠ½è±¡æ¥å£ï¼Œå®ƒç›´æ¥æ“ä½œä¼ è¾“å±‚åè®®(å¦‚<code>TCP</code>ã€<code>UDP</code>ç­‰)æ¥å·¥ä½œã€‚å®ƒä»¬ä¸æ˜¯ä¸€ä¸ªå±‚çº§ä¸Šçš„æ¦‚å¿µã€‚<br>æ‰€ä»¥ï¼Œåªè¦Socketä¸¤ç«¯ä¸ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå°±å¯ä»¥é€šè¿‡TCPè¿æ¥æ¥åŒå‘é€šä¿¡ã€‚<br>è€ŒHTTPæœåŠ¡å™¨åˆ™æŒ‰ç…§HTTPåè®®æ¥é€šä¿¡ï¼š<code>å»ºç«‹TCPè¿æ¥ ğŸ¡º å®¢æˆ·ç«¯å‘é€æŠ¥æ–‡ ğŸ¡º æœåŠ¡å™¨ç›¸åº”æŠ¥æ–‡ ğŸ¡º å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å…³é—­è¿æ¥</code>ã€‚æ¯ä¸€ä¸ªè¯·æ±‚éƒ½è¦é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚è™½è¯´TCPåè®®æ˜¯é•¿è¿æ¥çš„ï¼Œä½†ä¸Šå±‚çš„HTTPåè®®ä¼šä¸»åŠ¨å…³é—­å®ƒã€‚<br>å¦å¤–HTTPä¸­æœ‰ä¸€ä¸ª<code>Connection: keep-alive</code>å¤´ä¿¡æ¯ï¼Œæ¥é‡ç”¨è¿æ¥ï¼Œå‡å°‘åˆ›å»ºè¿æ¥çš„æ¶ˆè€—ã€‚å®ƒå—åˆ°é‡ç”¨æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´çš„é™åˆ¶(æœåŠ¡å™¨è®¾ç½®)ï¼Œè§¦å‘é™åˆ¶æ—¶ä»ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚å› æ­¤è¿™ä¸ªæ‰€è°“çš„â€é•¿è¿æ¥â€å’ŒSocketé•¿è¿æ¥çš„æœ¬è´¨æ˜¯ä¸åŒçš„ã€‚</p>
<p>Socket Serverä¾‹å­ï¼Œå†…å±‚çš„forå¾ªç¯è¯»å¹¶ä¸ä¼šä¸»åŠ¨å…³é—­è¿æ¥(ä¸å‘ç”Ÿpanicæ—¶)</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    srv, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-string">&quot;:8080&quot;</span>) <span class="hljs-comment">// åè®®ï¼Œç«¯å£</span><br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-built_in">panic</span>(err)<br>    &#125;<br>    <span class="hljs-keyword">defer</span> srv.Close()<br><br>    <span class="hljs-keyword">for</span> &#123;<br>        conn, err := srv.Accept() <span class="hljs-comment">// ç›‘å¬è¿æ¥</span><br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            fmt.Println(<span class="hljs-string">&quot;accept failed:&quot;</span>, err.Error())<br>            <span class="hljs-keyword">continue</span><br>        &#125;<br><br>        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c net.Conn)</span></span>&#123;<br>            <span class="hljs-keyword">defer</span> c.Close()<br>            buf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">1024</span>)<br>            <span class="hljs-keyword">for</span> &#123;<br>                n, err := c.Read(buf) <span class="hljs-comment">// å°è¯•è¯»æ•°æ®</span><br>                <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>                    fmt.Println(<span class="hljs-string">&quot;read failed:&quot;</span>, err.Error())<br>                    <span class="hljs-keyword">continue</span><br>                &#125;<br><br>                receiveData := buf[:n] <span class="hljs-comment">// æ¥æ”¶åˆ°çš„å­—èŠ‚buf[0:n]</span><br>                fmt.Println(<span class="hljs-string">&quot;received data=&quot;</span>, receiveData)<br>            &#125;<br>        &#125;(conn)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>HTTP Server</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> handler <span class="hljs-keyword">struct</span> &#123;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(h handler)</span></span> ServeHTTP(w http.ResponseWriter, r *http.Request) &#123;<br>    requestUrl := r.URL.String()<br>    msg := fmt.Sprintf(<span class="hljs-string">&quot;request uri=%s\n&quot;</span>, requestUrl)<br>    fmt.Println(msg)<br>    _, _ = w.Write([]<span class="hljs-type">byte</span>(msg))<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    err := http.ListenAndServe(<span class="hljs-string">&quot;127.0.0.1:8080&quot;</span>, handler&#123;&#125;) <span class="hljs-comment">//åœ°å€ã€ç«¯å£ï¼Œå¤„ç†å¥æŸ„</span><br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-built_in">panic</span>(err)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>HTTP Serverçš„åº•å±‚è¿˜æ˜¯TCPè¿æ¥ï¼Œå¯¹æ¯”ä¸Šé¢Socket Serverçš„ä»£ç ï¼Œæˆ‘ä»¬æœŸæœ›åœ¨HTTP Serverçš„å®ç°é‡Œå‘ç°</p>
<ol>
<li>åˆ›å»ºè¿æ¥<code>net.Listen</code></li>
<li>ç½‘ç»œç›‘å¬<code>srv.Accept()</code></li>
<li>è¯»å–æ•°æ®<code>c.Read(buf)</code></li>
<li>é¢å¤–çš„ï¼Œåœ¨æœåŠ¡ç«¯å‘é€å®Œæ•°æ®åï¼Œåº”è¯¥è¦å…³é—­è¿æ¥</li>
</ol>
<p>å¸¦ç€ä»¥ä¸Šå››ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬æ¥è·Ÿä¸€ä¸‹HTTP Serverçš„å¯åŠ¨è¿‡ç¨‹ã€‚</p>
<ol>
<li>å¯åŠ¨HTTP Server<code>err := http.ListenAndServe(&quot;127.0.0.1:8080&quot;, handler&#123;&#125;)</code> <a href="/images/golang/gin/Server_start.png" data-caption="Server_start" data-fancybox class="fancy_box_trg">&nbsp;</a></li>
<li>æ„é€ serverå¯¹è±¡ <a href="/images/golang/gin/Server_struct.png" data-caption="Server_struct" data-fancybox class="fancy_box_trg">&nbsp;</a></li>
</ol>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ListenAndServe</span><span class="hljs-params">(addr <span class="hljs-type">string</span>, handler Handler)</span></span> <span class="hljs-type">error</span> &#123;<br>    server := &amp;Server&#123;Addr: addr, Handler: handler&#125;<br>    <span class="hljs-keyword">return</span> server.ListenAndServe()<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>è°ƒç”¨serverçš„<code>ListenAndServe</code>æ–¹æ³•ã€‚åœ¨#Line9æˆ‘ä»¬å‘ç°äº†<code>net.Listen(&quot;tcp&quot;, addr)</code>ï¼Œ<strong>ç›®æ ‡1æ‰¾åˆ°</strong>ã€‚</li>
</ol>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(srv *Server)</span></span> ListenAndServe() <span class="hljs-type">error</span> &#123;<br>    <span class="hljs-keyword">if</span> srv.shuttingDown() &#123;<br>        <span class="hljs-keyword">return</span> ErrServerClosed<br>    &#125;<br>    addr := srv.Addr<br>    <span class="hljs-keyword">if</span> addr == <span class="hljs-string">&quot;&quot;</span> &#123;<br>        addr = <span class="hljs-string">&quot;:http&quot;</span><br>    &#125;<br>    ln, err := net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, addr)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> err<br>    &#125;<br>    <span class="hljs-keyword">return</span> srv.Serve(ln)<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>è·Ÿå…¥#Line13è¡Œä»£ç <code>srv.Serve(ln)</code> <a href="/images/golang/gin/srv.Serve.png" data-fancybox data-caption="srv.Serve" class="fancy_box_trg">&nbsp;</a>ã€‚è¿™é‡Œï¼Œ#Line4:<code>rw,err := l.Accept()</code>ï¼Œ<strong>ç›®æ ‡2æ‰¾åˆ°</strong>ã€‚<br>è¿™é‡Œçš„<code>rw</code>å³æ˜¯<code>net.Conn</code>ï¼Œåœ¨#Line14é‡æ–°åŒ…è£…äº†<code>rw</code> <a href="/images/golang/gin/srv.newConn.png" data-fancybox data-caption="srv.newConn" class="fancy_box_trg">&nbsp;</a>ï¼Œï¼Œå¹¶åœ¨#Line14å¯åŠ¨åç¨‹<code>go c.serve(connCtx)</code>ã€‚<br>åˆ°æ­¤ï¼ŒæœåŠ¡å™¨å·²ç»æ­£å¸¸å¯åŠ¨ï¼Œå¹¶ä¸”ç»™æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„Requestéƒ½åˆ†é…äº†ä¸€ä¸ªåç¨‹ã€‚#Line3çš„forå¾ªç¯é…åˆgolangè½»åç¨‹çš„ç‰¹æ€§ï¼Œä¸€ä¸ªé«˜å¹¶å‘çš„webæœåŠ¡å™¨å¯åŠ¨äº†ã€‚</li>
</ol>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(srv *Server)</span></span> Serve(l net.Listener) <span class="hljs-type">error</span> &#123;<br>    ...<br>    <span class="hljs-keyword">for</span> &#123;<br>        rw, err := l.Accept()<br>        ...<br>        connCtx := ctx<br>        <span class="hljs-keyword">if</span> cc := srv.ConnContext; cc != <span class="hljs-literal">nil</span> &#123;<br>            connCtx = cc(connCtx, rw)<br>            <span class="hljs-keyword">if</span> connCtx == <span class="hljs-literal">nil</span> &#123;<br>                <span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;ConnContext returned nil&quot;</span>)<br>            &#125;<br>        &#125;<br>        tempDelay = <span class="hljs-number">0</span><br>        c := srv.newConn(rw)<br>        c.setState(c.rwc, StateNew) <span class="hljs-comment">// before Serve can return</span><br>        <span class="hljs-keyword">go</span> c.serve(connCtx)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>ç»§ç»­æŒ–<code>go c.serve(connCtx)</code>çœ‹çœ‹<code>net/http</code>æ˜¯å¦‚ä½•å¤„ç†ä¸€ä¸ªRequestçš„ã€‚å…ˆå¿«é€Ÿæ‰«ä¸€ä¸‹è¿™ä¸ªå‡½æ•°é‡Œé¢åšäº†å“ªäº›äº‹æƒ…ï¼š</li>
<li>#Line20<code>w, err := c.readRequest(ctx)</code>æ„å»ºResponseå¯¹è±¡ã€‚å‘å†…è¿½æ‰¾åˆ°HTTPåè®®çš„è§£æè¿‡ç¨‹<code>newTextprotoReader</code>ã€‚<strong>ç›®æ ‡3æ‰¾åˆ°</strong>ã€‚</li>
<li>#Line35<code>serverHandler&#123;c.server&#125;.ServeHTTP(w, w.req)</code> å¤„ç†ä¸šåŠ¡é€»è¾‘(å³ç”¨æˆ·å®šä¹‰çš„è·¯ç”±é€»è¾‘)ã€‚<code>ServeHTTP</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>w</code>å°±æ˜¯Responseå¯¹è±¡ï¼Œè´Ÿè´£å‘å®¢æˆ·ç«¯å“åº”æ•°æ®ï¼Œ<code>w.req</code>å³Requestï¼Œè´Ÿè´£è§£æè¯·æ±‚å‚æ•°ã€å¤´ä¿¡æ¯ç­‰ã€‚</li>
<li>#Line40<code>w.finishRequest()</code>ä¸­æœ‰flushæ“ä½œï¼Œåˆ°è¿™é‡ŒæœåŠ¡å™¨å·²ç»å®Œæˆäº†æ•°æ®å“åº”ã€‚</li>
<li>#Line50-64å¤„ç†äº†<code>keep-alive</code>é‡ç”¨è¿æ¥å’Œ<code>idle_timeout</code>ç©ºé—²è¶…æ—¶æ–­å¼€è¿æ¥çš„é€»è¾‘ã€‚è¿™é‡Œæ¶‰åŠåˆ°ä¸€äº›ç½‘ç»œçŸ¥è¯†ä¸å…·ä½“å±•å¼€ã€‚<br>è‹¥è®¾ç½®äº†<code>Connection: close</code>æˆ–è€…æœåŠ¡å™¨ä¿æŒè¿æ¥ç›´åˆ°ç©ºé—²è¶…æ—¶ï¼Œéƒ½ä¼šreturnä»è€Œæ‰§è¡Œ#Line5ä¸­çš„deferä»£ç ,æ³¨æ„æºä»£ç ä¸­çš„#Line1775~1777 <a href="/images/golang/gin/defer_conn_close.png" data-fancybox data-caption="defer_conn_close" class="fancy_box_trg">&nbsp;</a>ã€‚<strong>ç›®æ ‡4æ‰¾åˆ°</strong></li>
<li>éœ€è¦é¢å¤–å…³æ³¨ä¸€ä¸‹#Line35è¡Œä¸Šé¢çš„æ³¨é‡Š <a href="/images/golang/gin/serverHandler_comments.png" data-fancybox data-caption="serverHandler_comments" class="fancy_box_trg">&nbsp;</a>ã€‚è¿™é‡Œæ˜ç¡®æŒ‡å‡ºäº†<code>net/http</code>æ²¡æœ‰å®ç°pipelineï¼Œç†ç”±æ˜¯åœ¨HTTP1.1ä¸­pipelineå¹¶æ²¡æœ‰è¢«ï¼ˆå®¢æˆ·ç«¯/æµè§ˆå™¨ï¼‰å¹¿æ³›çš„å®ç°ï¼Œå› æ­¤æ‰”åˆ°äº†å’ŒHTTP2.0ä¸€èµ·å®ç°ã€‚</li>
</ol>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// Serve a new connection.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *conn)</span></span> serve(ctx context.Context) &#123;<br>    c.remoteAddr = c.rwc.RemoteAddr().String()<br>    ctx = context.WithValue(ctx, LocalAddrContextKey, c.rwc.LocalAddr())<br>    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;...&#125;()<br><br>    ...<br><br>    <span class="hljs-comment">// HTTP/1.x from here on.</span><br><br>    ctx, cancelCtx := context.WithCancel(ctx)<br>    c.cancelCtx = cancelCtx<br>    <span class="hljs-keyword">defer</span> cancelCtx()<br><br>    c.r = &amp;connReader&#123;conn: c&#125;<br>    c.bufr = newBufioReader(c.r)<br>    c.bufw = newBufioWriterSize(checkConnErrorWriter&#123;c&#125;, <span class="hljs-number">4</span>&lt;&lt;<span class="hljs-number">10</span>)<br><br>    <span class="hljs-keyword">for</span> &#123;<br>        w, err := c.readRequest(ctx)<br>        <span class="hljs-keyword">if</span> c.r.remain != c.server.initialReadLimitSize() &#123;<br>            <span class="hljs-comment">// If we read any bytes off the wire, we&#x27;re active.</span><br>            c.setState(c.rwc, StateActive)<br>        &#125;<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;...&#125;<br><br>        <span class="hljs-comment">// Expect 100 Continue support</span><br>        req := w.req<br>        <span class="hljs-keyword">if</span> req.expectsContinue() &#123;...&#125;<br><br>        c.curReq.Store(w)<br><br>        <span class="hljs-keyword">if</span> requestBodyRemains(req.Body) &#123;...&#125;<br><br>        serverHandler&#123;c.server&#125;.ServeHTTP(w, w.req)<br>        w.cancelCtx()<br>        <span class="hljs-keyword">if</span> c.hijacked() &#123;<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        w.finishRequest()<br>        <span class="hljs-keyword">if</span> !w.shouldReuseConnection() &#123;<br>            <span class="hljs-keyword">if</span> w.requestBodyLimitHit || w.closedRequestBodyEarly() &#123;<br>                c.closeWriteAndWait()<br>            &#125;<br>            <span class="hljs-keyword">return</span><br>        &#125;<br>        c.setState(c.rwc, StateIdle)<br>        c.curReq.Store((*response)(<span class="hljs-literal">nil</span>))<br><br>        <span class="hljs-keyword">if</span> !w.conn.server.doKeepAlives() &#123;<br>            <span class="hljs-comment">// We&#x27;re in shutdown mode. We might&#x27;ve replied</span><br>            <span class="hljs-comment">// to the user without &quot;Connection: close&quot; and</span><br>            <span class="hljs-comment">// they might think they can send another</span><br>            <span class="hljs-comment">// request, but such is life with HTTP/1.1.</span><br>            <span class="hljs-keyword">return</span><br>        &#125;<br><br>        <span class="hljs-keyword">if</span> d := c.server.idleTimeout(); d != <span class="hljs-number">0</span> &#123;<br>            c.rwc.SetReadDeadline(time.Now().Add(d))<br>            <span class="hljs-keyword">if</span> _, err := c.bufr.Peek(<span class="hljs-number">4</span>); err != <span class="hljs-literal">nil</span> &#123;<br>                <span class="hljs-keyword">return</span><br>            &#125;<br>        &#125;<br>        c.rwc.SetReadDeadline(time.Time&#123;&#125;)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>P.S. è¿™é‡Œå†é¢å¤–æŒ–ä¸€ä¸‹#Line35<code>serverHandler&#123;c.server&#125;.ServeHTTP(w, w.req)</code>çš„å®ç°ï¼Œå°†ç”¨æˆ·ä»£ç å’Œ<code>net/http</code>åŒ…æ‰“é€šã€‚<br>è¿™é‡Œé¦–å…ˆæ„é€ äº†ä¸€ä¸ªserverHandlerå¯¹è±¡å¹¶è°ƒç”¨äº†å®ƒçš„<code>ServeHTTP</code>æ–¹æ³•ã€‚<a href="/images/golang/gin/serverHandler_ServeHTTP.png" data-fancybox data-caption="serverHandler_ServeHTTP" class="fancy_box_trg">&nbsp;</a><br>ä¹‹åï¼Œè°ƒç”¨äº†<code>sh.srv.Handler.ServeHTTP(rw, req)</code>ï¼Œè¿™é‡Œçš„<code>srv</code>å°±æ˜¯æœ¬æ–‡æ­¥éª¤2ä¸­<code>æ„é€ serverå¯¹è±¡</code>çš„è¿™ä¸ªserverå¯¹è±¡ã€‚<br>å› æ­¤è¿™é‡Œçš„<code>.Handler.ServeHTTP</code>æœ€ç»ˆè°ƒç”¨çš„æ˜¯æˆ‘ä»¬çš„<code>HTTP Server</code>demoä¸­#Line4-9çš„ä»£ç ã€‚</p>
<h2 id="Ginçš„å¯åŠ¨è¿‡ç¨‹"><a href="#Ginçš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Ginçš„å¯åŠ¨è¿‡ç¨‹"></a>Ginçš„å¯åŠ¨è¿‡ç¨‹</h2><p>æŒ–å®Œäº†<code>net/http</code>åŒ…ï¼Œå¯¹httpç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹æœ‰äº†ä¸€ä¸ªæ•´ä½“çš„è®¤çŸ¥ï¼Œæ¥ä¸‹æ¥æ­£å¼å¼€æŒ–Ginã€‚</p>
<ol>
<li>å¯åŠ¨æœåŠ¡éå¸¸ç®€ä¾¿<code>engine := gin.New()</code>ç„¶å<code>engine.Run(&quot;:8080&quot;)</code> <a href="/images/golang/gin/gin_New.png" data-caption="gin_New" data-fancybox class="fancy_box_trg">&nbsp;</a></li>
</ol>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    engine := gin.New()<br><br>    <span class="hljs-comment">//engine.GET(&quot;/someGet&quot;, getting)</span><br>    ...<br>    <span class="hljs-comment">//engine.Use(middlewares.Authenticate())</span><br><br>    engine.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li><code>gin.New()</code>çš„ç»†èŠ‚ã€‚å…¶ä¸­<code>Engine</code>çš„ç»“æ„ <a href="/images/golang/gin/gin_Engine.png" data-caption="gin_Engine" data-fancybox class="fancy_box_trg">&nbsp;</a><br>å…¶ä¸­ï¼š</li>
</ol>
<ul>
<li><code>RedirectTrailingSlash</code>è‹¥è¯·æ±‚åœ°å€æ˜¯<code>/foo/</code>ä¸”æœªåŒ¹é…ï¼Œä½†<code>/foo</code>å¯ä»¥åŒ¹é…ï¼Œåˆ™å°†å®¢æˆ·ç«¯é‡å®šå‘åˆ°<code>/foo</code>ï¼Œè‹¥è¯·æ±‚æ˜¯GETåˆ™çŠ¶æ€ç æ˜¯301ï¼Œå…¶ä»–åŠ¨è¯åˆ™æ˜¯307</li>
<li><code>RedirectFixedPath</code>æœªåŒ¹é…æ—¶å°è¯•å»é™¤å¤šä½™çš„<code>../</code>æˆ–<code>//</code>ä»¥ä¿®æ­£è·¯å¾„(ä¸”è½¬åŒ–ä¸ºå°å†™)ï¼Œä¾‹å¦‚<code>/FOO</code>æˆ–<code>/..//FOO</code>éƒ½èƒ½åŒ¹é…<code>/foo</code></li>
<li><code>HandleMethodNotAllowed</code>æœªåŒ¹é…æ—¶å°è¯•å…¶ä»–åŠ¨è¯ï¼Œè‹¥è·¯ç”±åŒ¹é…åˆ™ä»¥çŠ¶æ€ç 405å“åº”ï¼Œå¦åˆ™å°†è¯·æ±‚ä»£ç†åˆ°<code>NotFound</code>å¥æŸ„ã€‚</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// New returns a new blank Engine instance without any middleware attached.</span><br><span class="hljs-comment">// By default the configuration is:</span><br><span class="hljs-comment">// - RedirectTrailingSlash:  true</span><br><span class="hljs-comment">// - RedirectFixedPath:      false</span><br><span class="hljs-comment">// - HandleMethodNotAllowed: false</span><br><span class="hljs-comment">// - ForwardedByClientIP:    true</span><br><span class="hljs-comment">// - UseRawPath:             false</span><br><span class="hljs-comment">// - UnescapePathValues:     true</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span></span> *Engine &#123;<br>    debugPrintWARNINGNew() <span class="hljs-comment">//debugæ¨¡å¼ä¸‹æ‰“å°å¼€å‘æ¨¡å¼è­¦å‘Š</span><br>    engine := &amp;Engine&#123;<br>        RouterGroup: RouterGroup&#123; <span class="hljs-comment">// è·¯ç”±åˆ†ç»„</span><br>            Handlers: <span class="hljs-literal">nil</span>,<br>            basePath: <span class="hljs-string">&quot;/&quot;</span>,<br>            root:     <span class="hljs-literal">true</span>,<br>        &#125;,<br>        FuncMap:                template.FuncMap&#123;&#125;, <span class="hljs-comment">// æ¨¡æ¿å‡½æ•°ï¼Ÿ</span><br>        RedirectTrailingSlash:  <span class="hljs-literal">true</span>,<br>        RedirectFixedPath:      <span class="hljs-literal">false</span>,<br>        HandleMethodNotAllowed: <span class="hljs-literal">false</span>,<br>        ForwardedByClientIP:    <span class="hljs-literal">true</span>,<br>        AppEngine:              defaultAppEngine,<br>        UseRawPath:             <span class="hljs-literal">false</span>,<br>        UnescapePathValues:     <span class="hljs-literal">true</span>,<br>        MaxMultipartMemory:     defaultMultipartMemory,<br>        trees:                  <span class="hljs-built_in">make</span>(methodTrees, <span class="hljs-number">0</span>, <span class="hljs-number">9</span>),<br>        delims:                 render.Delims&#123;Left: <span class="hljs-string">&quot;&#123;&#123;&quot;</span>, Right: <span class="hljs-string">&quot;&#125;&#125;&quot;</span>&#125;,<br>        secureJsonPrefix:       <span class="hljs-string">&quot;while(1);&quot;</span>,<br>    &#125;<br>    engine.RouterGroup.engine = engine<br>    engine.pool.New = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">interface</span>&#123;&#125; &#123; <span class="hljs-comment">// è¿æ¥æ± </span><br>        <span class="hljs-keyword">return</span> engine.allocateContext()<br>    &#125;<br>    <span class="hljs-keyword">return</span> engine<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>engine.Run(&quot;:8080&quot;)</code>ä¸­çš„ç»†èŠ‚ã€‚å®ƒä»…ä»…æ˜¯<code>http.ListenAndServe(address, engine)</code>çš„è¯­æ³•ç³–ï¼Œå•¥ä¹Ÿæ²¡åšã€‚<br>å› æ­¤å¯ä»¥çœ‹å‡ºæ¥ï¼ŒGinå¯¹ç½‘ç»œåº•å±‚æ²¡åšä»»ä½•å¤„ç†ï¼Œç›´æ¥ä½¿ç”¨äº†<code>net/http</code>åŒ…ã€‚å…¶æ ¸å¿ƒä»£ç å…¨éƒ¨åœ¨<code>Engine</code>è¿™ä¸ªç»“æ„ä½“ä¸­ã€‚æ ¹æ®æˆ‘ä»¬åˆ†æ<code>net/http</code>åŒ…çš„ç»éªŒï¼ŒEngineä¸­ä¸€å®šå®ç°äº†<code>ServeHTTP</code>æ–¹æ³•</li>
</ol>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// Run attaches the router to a http.Server and starts listening and serving HTTP requests.</span><br><span class="hljs-comment">// It is a shortcut for http.ListenAndServe(addr, router)</span><br><span class="hljs-comment">// Note: this method will block the calling goroutine indefinitely unless an error happens.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> Run(addr ...<span class="hljs-type">string</span>) (err <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; debugPrintError(err) &#125;()<br><br>    address := resolveAddress(addr) <span class="hljs-comment">// addr æ˜¯åŠ¨æ€å‚æ•°ï¼Œé»˜è®¤å€¼å–:8080</span><br>    debugPrint(<span class="hljs-string">&quot;Listening and serving HTTP on %s\n&quot;</span>, address)<br>    err = http.ListenAndServe(address, engine)<br>    <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li><code>engine.ServeHTTP</code>åˆ°åº•å¹²äº†å•¥ï¼Ÿ <code>Engine</code>ç»“æ„ä½“çš„æ–¹æ³•é›†ï¼š<br><img src="/images/golang/gin/gin_Engine_methods.png" alt="gin_Engine_methods"></li>
</ol>
<p><code>gin.Context</code> <a href="/images/golang/gin/gin_Context.png" data-caption="gin_Context" data-fancybox class="fancy_box_trg">&nbsp;</a></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// ServeHTTP conforms to the http.Handler interface.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> ServeHTTP(w http.ResponseWriter, req *http.Request) &#123;<br>    <span class="hljs-comment">// æºç #Line145è¡Œå®šä¹‰ï¼Œè¿™é‡Œè¿”å›engine.allocateContext()çš„ç»“æœ</span><br>    <span class="hljs-comment">// æ˜¯*gin.ContextæŒ‡é’ˆ</span><br>    c := engine.pool.Get().(*Context) <span class="hljs-comment">// ä»è¿æ¥æ± ä¸­å–å‡ºä¸€ä¸ªè¿æ¥</span><br>    c.writermem.reset(w) <span class="hljs-comment">// é‡ç½® http.responseWriter</span><br>    c.Request = req<br>    c.reset() <span class="hljs-comment">// é‡ç½®Context</span><br><br>    engine.handleHTTPRequest(c) <span class="hljs-comment">// æ ¸å¿ƒ!!! è·¯ç”±å¤„ç†é€»è¾‘</span><br><br>    engine.pool.Put(c) <span class="hljs-comment">// æ‰§è¡Œç»“æŸï¼Œå°†è¿æ¥æ”¾å…¥è¿æ¥æ± </span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="5">
<li><code>engine.handleHTTPRequest(c)</code>çš„ç»†èŠ‚ã€‚</li>
</ol>
<p><img src="/images/golang/gin/engine_handleHTTPRequest.png" alt="engine_handleHTTPRequest"></p>
<p>å¯ä»¥çœ‹åˆ°æºç #Line403è¡Œè°ƒç”¨<code>c.Next()</code>å<code>c.index</code>ä»-1è‡ªå¢åˆ°0ï¼Œç„¶åè°ƒç”¨<code>c.handlers[0]</code>å¥æŸ„ï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªä¸­é—´ä»¶<code>RouteLogger</code>ï¼Œè€Œåœ¨ä¸­é—´ä»¶ä¸­æˆ‘ä»¬éœ€è¦å†æ¬¡è°ƒç”¨<code>c.Next()</code>ã€‚éå¸¸æ˜æ˜¾çš„ä¸€ä¸ªé€’å½’è°ƒç”¨ï¼Œç„¶åæ‰§è¡Œç¬¬äºŒä¸ªä¸­é—´ä»¶<code>RecoverWithWriter</code>ï¼Œä¹‹åè°ƒç”¨<code>GET</code>åŠ¨è¯æ³¨å†Œçš„è·¯ç”±<code>api.Ping</code>ï¼Œæœ€åè°ƒç”¨é“¾è·¯ä¾æ¬¡è¿”å›ã€‚<br>å‚è€ƒä¸‹å›¾ï¼ˆç‚¹å‡»å¯æ”¾å¤§ï¼‰<br><a href="/images/golang/gin/gin_Route_Next.png" data-caption="gin_Route_Next" data-fancybox><br><img src="/images/golang/gin/gin_Route_Next.png" alt="gin_Route_Next"><br></a></p>
<h1 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h1><p>Ginçš„è·¯ç”±æŒ‰HTTPåŠ¨è¯ï¼Œåˆ†9ç»„ï¼ˆé»˜è®¤<code>engine.trees = make(methodTrees, 0, 9)</code>ï¼‰åˆ†åˆ«å¯¹åº”<code>GET</code>ç»„ï¼Œ<code>POST</code>ç»„ï¼Œ<code>PUT</code>ç»„ç­‰ã€‚<code>methodTrees</code>æ˜¯<code>[]methodTree</code>çš„åˆ«åï¼š<code>type methodTrees []methodTree</code>ã€‚<br><code>node</code>æ˜¯ä¸€é¢—å‰ç¼€æ ‘æˆ–<code>Radix trie</code>ã€‚</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> methodTree <span class="hljs-keyword">struct</span> &#123;<br>    method <span class="hljs-type">string</span> <span class="hljs-comment">// å³HTTPåŠ¨è¯ï¼Œå¦‚GET</span><br>    root   *node  <span class="hljs-comment">// è·¯ç”±é“¾è·¯</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a><code>Trie</code></h2><p><code>trie</code>è¯‘ä¸ºå­—å…¸æ ‘æˆ–å•è¯æŸ¥æ‰¾æ ‘æˆ–å‰ç¼€æ ‘ã€‚è¿™æ˜¯ä¸€ç§æœç´¢æ ‘â€”â€”å­˜å‚¨åŠ¨æ€é›†åˆæˆ–å…³è”æ•°ç»„çš„æœ‰åºçš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œä¸”é€šå¸¸ä½¿ç”¨å­—ç¬¦ä¸²åšé”®ã€‚ä¸äºŒå‰æœç´¢æ ‘ä¸åŒï¼Œå…¶èŠ‚ç‚¹ä¸Šå¹¶ä¸ç›´æ¥å­˜é”®ã€‚å…¶åœ¨æ ‘ä¸­çš„ä½ç½®å†³å®šäº†ä¸å…¶å…³è”çš„é”®ã€‚æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æœ‰ç›¸åŒçš„å‰ç¼€ï¼Œè€Œæ ¹èŠ‚ç‚¹å¯¹åº”çš„æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚é”®åªä¸å¶å­èŠ‚ç‚¹å…³è”ã€‚</p>
<p><code>trie</code>æœ¯è¯­çš„å‘æ˜è€…å¿µ<code>/ËˆtriË/</code>(tree)ï¼Œè€Œæœ‰äº›ä½œè€…å¿µä¸º<code>/ËˆtraÉª/</code>ä»¥ä¾¿å’ŒtreeåŒºåˆ«ã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€é¢—å­—å…¸æ ‘ï¼Œæè¿°äº†é”®å€¼ä¸º<code>A</code>ã€<code>to</code>ã€<code>tea</code>ã€<code>ted</code>ã€<code>ten</code>ã€<code>i</code>ã€<code>in</code>ã€<code>inn</code>çš„æƒ…å†µã€‚ï¼ˆå›¾ä¸­èŠ‚ç‚¹å¹¶ä¸æ˜¯å®Œå…¨æœ‰åºçš„ï¼Œè™½ç„¶åº”è¯¥å¦‚æ­¤ï¼šå¦‚rootèŠ‚ç‚¹ä¸<code>t</code>èŠ‚ç‚¹ï¼‰<br><img src="/images/golang/gin/Trie_example.svg" alt="wikiå­—å…¸æ ‘"></p>
<p>ä¸éš¾æƒ³è±¡ï¼Œå­—å…¸æ ‘å…¸å‹çš„åº”ç”¨åœºæ™¯æ˜¯å•è¯è®¡æ•°ã€‚</p>
<h3 id="trieé€šå¸¸ç”¨æ¥å–ä»£hash-tableï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š"><a href="#trieé€šå¸¸ç”¨æ¥å–ä»£hash-tableï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š" class="headerlink" title="trieé€šå¸¸ç”¨æ¥å–ä»£hash tableï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š"></a><code>trie</code>é€šå¸¸ç”¨æ¥å–ä»£<code>hash table</code>ï¼Œå› ä¸ºæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</h3><ul>
<li>åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œ<code>trie</code>çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(m)</code>ï¼Œå…¶ä¸­mæ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ä½†å“ˆå¸Œè¡¨æœ‰<code>key</code>ç¢°æ’çš„æƒ…å†µï¼Œæœ€åçš„æƒ…å†µä¸‹å…¶å¤æ‚åº¦æ˜¯<code>O(N)</code>ï¼Œè™½ç„¶é€šå¸¸æ˜¯<code>O(1)</code>ï¼Œä¸”è®¡ç®—å“ˆå¸Œçš„å¤æ‚åº¦æ˜¯<code>O(m)</code>ã€‚</li>
<li><code>trie</code>ä¸­æ²¡æœ‰ç¢°æ’ã€‚</li>
<li>å½“<code>trie</code>ä¸­ä¸€ä¸ª<code>key</code>å¯¹åº”å¤šä¸ªå€¼æ—¶ï¼Œä¼šä½¿ç”¨<code>buckets</code>æ¥å­˜å‚¨å¤šä¸ªå€¼ï¼Œä¸å“ˆå¸Œè¡¨ä¸­å‘ç”Ÿç¢°æ’æ—¶ä½¿ç”¨çš„æ¡¶ç›¸ä¼¼ã€‚</li>
<li>ä¸è®ºæœ‰å¤šå°‘ä¸ª<code>key</code>ï¼Œéƒ½ä¸éœ€å“ˆå¸Œå‡½æ•°æˆ–é‡å“ˆå¸Œå‡½æ•°ã€‚</li>
<li><code>key</code>çš„è·¯å¾„æ˜¯æœ‰åºçš„ã€‚</li>
</ul>
<h3 id="ä½†åŒæ—¶ï¼Œç›¸å¯¹å“ˆå¸Œè¡¨ï¼Œtrieæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š"><a href="#ä½†åŒæ—¶ï¼Œç›¸å¯¹å“ˆå¸Œè¡¨ï¼Œtrieæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š" class="headerlink" title="ä½†åŒæ—¶ï¼Œç›¸å¯¹å“ˆå¸Œè¡¨ï¼Œtrieæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š"></a>ä½†åŒæ—¶ï¼Œç›¸å¯¹å“ˆå¸Œè¡¨ï¼Œ<code>trie</code>æœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</h3><ul>
<li><code>trie</code>çš„æœç´¢é€šå¸¸æ¯”å“ˆå¸Œè¡¨æ…¢ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ä»ç¡¬ç›˜ä¸ŠåŠ è½½æ•°æ®æ—¶ã€‚</li>
<li>æµ®ç‚¹æ•°åš<code>key</code>é€šå¸¸å¯¼è‡´é“¾è·¯è¿‡é•¿ã€‚</li>
<li>æœ‰äº›<code>trie</code>å¯èƒ½æ¯”å“ˆå¸Œè¡¨éœ€è¦æ›´å¤šçš„ç©ºé—´ï¼Œå› ä¸ºæ¯ä¸€ä¸ªå­—ç¬¦éƒ½è¦åˆ†é…å†…å­˜ã€‚è€Œå“ˆå¸Œè¡¨åªéœ€è¦ç”³è¯·ä¸€å—å†…å­˜ã€‚</li>
</ul>
<img src="/images/golang/gin/trie_example_001.png" alt="trie_001" style="width:30em;" />

<h2 id="Radix-Tree"><a href="#Radix-Tree" class="headerlink" title="Radix Tree"></a><code>Radix Tree</code></h2><p><code>radix tree</code>ä¹Ÿå«<code>radix trie</code>æˆ–<code>compact prefix trie</code>ã€‚åœ¨å­—å…¸æ ‘ä¸­ï¼Œæ¯ä¸€ä¸ªå­—ç¬¦éƒ½è¦å ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·é€ æˆæ ‘è¿‡é«˜ã€‚<code>radix trie</code>åˆ™å°†å”¯ä¸€çš„å­èŠ‚ç‚¹å‹ç¼©åˆ°è‡ªèº«æ¥é™ä½æ ‘çš„é«˜åº¦ã€‚</p>
<hr>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Trie">å­—å…¸æ ‘</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Radix_tree">Radixæ ‘</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=CX777rfuZtM">Trie Data Structure Tutorial - Introduction to the Trie Data Structure</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=jXAHLqQthKw">Trie and Patricia Trie Overview</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/HzGS0ekNFubJGjj19NxlEw">å›¾è§£Redisä¸­çš„Radixæ ‘</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/4DWC9Upv2UEXKssb8DDwVw">Linux å†…æ ¸æ•°æ®ç»“æ„ï¼šRadixæ ‘</a></li>
</ol>
<h1 id="è§£æè¯·æ±‚å‚æ•°"><a href="#è§£æè¯·æ±‚å‚æ•°" class="headerlink" title="è§£æè¯·æ±‚å‚æ•°"></a>è§£æè¯·æ±‚å‚æ•°</h1><h1 id="æ¸²æŸ“JSON"><a href="#æ¸²æŸ“JSON" class="headerlink" title="æ¸²æŸ“JSON"></a>æ¸²æŸ“JSON</h1><h1 id="session-amp-cookie"><a href="#session-amp-cookie" class="headerlink" title="session &amp; cookie"></a>session &amp; cookie</h1><h1 id="URLé‡å®šå‘"><a href="#URLé‡å®šå‘" class="headerlink" title="URLé‡å®šå‘"></a>URLé‡å®šå‘</h1><h1 id="goroutin-inside-a-middleware"><a href="#goroutin-inside-a-middleware" class="headerlink" title="goroutin inside a middleware"></a>goroutin inside a middleware</h1><h1 id="æ—¥å¿—æ¨¡å—"><a href="#æ—¥å¿—æ¨¡å—" class="headerlink" title="æ—¥å¿—æ¨¡å—"></a>æ—¥å¿—æ¨¡å—</h1><h2 id="debugæ—¥å¿—"><a href="#debugæ—¥å¿—" class="headerlink" title="debugæ—¥å¿—"></a>debugæ—¥å¿—</h2><p><code>/debug.go#L55</code></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">debugPrint</span><span class="hljs-params">(format <span class="hljs-type">string</span>, values ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<br>    <span class="hljs-keyword">if</span> IsDebugging() &#123;<br>        <span class="hljs-keyword">if</span> !strings.HasSuffix(format, <span class="hljs-string">&quot;\n&quot;</span>) &#123;<br>            format += <span class="hljs-string">&quot;\n&quot;</span><br>        &#125;<br>        <span class="hljs-comment">// DefaultWriteræ˜¯åœ¨é¡¹ç›®bootstrapé˜¶æ®µé…ç½®çš„å†™å¥æŸ„</span><br>        <span class="hljs-comment">// å¯ä»¥é€šè¿‡DefaultWriter=io.MultiWriter(...)è‡ªå®šä¹‰</span><br>        <span class="hljs-comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼os.Stdoutè§/mode.go#L31-38</span><br>        fmt.Fprintf(DefaultWriter, <span class="hljs-string">&quot;[GIN-debug] &quot;</span>+format, values...)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>/debug.go#L97</code></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">debugPrintError</span><span class="hljs-params">(err <span class="hljs-type">error</span>)</span></span> &#123;<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">if</span> IsDebugging() &#123;<br>            <span class="hljs-comment">// DefaultErrorWriter is the default io.Writer used by Gin to debug errors</span><br>            fmt.Fprintf(DefaultErrorWriter, <span class="hljs-string">&quot;[GIN-debug] [ERROR] %v\n&quot;</span>, err)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="è·¯ç”±æ—¥å¿—"><a href="#è·¯ç”±æ—¥å¿—" class="headerlink" title="è·¯ç”±æ—¥å¿—"></a>è·¯ç”±æ—¥å¿—</h2><p><code>/logger.go#L131</code></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// defaultLogFormatter is the default log format function Logger middleware uses.</span><br><span class="hljs-keyword">var</span> defaultLogFormatter = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(param LogFormatterParams)</span></span> <span class="hljs-type">string</span> &#123;<br>    <span class="hljs-keyword">var</span> statusColor, methodColor, resetColor <span class="hljs-type">string</span><br>    <span class="hljs-keyword">if</span> param.IsOutpu123456<br>    or() &#123;<br>        statusColor = param.StatusCodeColor()<br>        methodColor = param.MethodColor()<br>        resetColor = param.ResetColor()<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> param.Latency &gt; time.Minute &#123;<br>        <span class="hljs-comment">// Truncate in a golang &lt; 1.8 safe way</span><br>        param.Latency = param.Latency - param.Latency%time.Second<br>    &#125;<br>    <span class="hljs-comment">// é»˜è®¤æ—¥å¿—æ ¼å¼ï¼š</span><br>    <span class="hljs-comment">//             [GIN] æ—¶é—´æˆ³|HTTP_Code|å“åº”æ—¶é—´|å®¢æˆ·IP| http_verb url é”™è¯¯ä¿¡æ¯ </span><br>    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;[GIN] %v |%s %3d %s| %13v | %15s |%s %-7s %s %#v\n%s&quot;</span>,<br>        param.TimeStamp.Format(<span class="hljs-string">&quot;2006/01/02 - 15:04:05&quot;</span>),<br>        statusColor, param.StatusCode, resetColor,<br>        param.Latency,<br>        param.ClientIP,<br>        methodColor, param.Method, resetColor,<br>        param.Path,<br>        param.ErrorMessage,<br>    )<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>/logger.go#L203</code></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// LoggerWithConfig instance a Logger middleware with config.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoggerWithConfig</span><span class="hljs-params">(conf LoggerConfig)</span></span> HandlerFunc &#123;<br>    formatter := conf.Formatter<br>    <span class="hljs-keyword">if</span> formatter == <span class="hljs-literal">nil</span> &#123;<br>        formatter = defaultLogFormatter<br>    &#125;<br><br>    out := conf.Output<br>    <span class="hljs-keyword">if</span> out == <span class="hljs-literal">nil</span> &#123;<br>        out = DefaultWriter<br>    &#125;<br><br>    notlogged := conf.SkipPaths<br><br>    isTerm := <span class="hljs-literal">true</span><br><br>    <span class="hljs-keyword">if</span> w, ok := out.(*os.File); !ok || os.Getenv(<span class="hljs-string">&quot;TERM&quot;</span>) == <span class="hljs-string">&quot;dumb&quot;</span> ||<br>        (!isatty.IsTerminal(w.Fd()) &amp;&amp; !isatty.IsCygwinTerminal(w.Fd())) &#123;<br>        isTerm = <span class="hljs-literal">false</span><br>    &#125;<br><br>    <span class="hljs-keyword">var</span> skip <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">struct</span>&#123;&#125;<br><br>    <span class="hljs-keyword">if</span> length := <span class="hljs-built_in">len</span>(notlogged); length &gt; <span class="hljs-number">0</span> &#123;<br>        skip = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">struct</span>&#123;&#125;, length)<br><br>        <span class="hljs-keyword">for</span> _, path := <span class="hljs-keyword">range</span> notlogged &#123;<br>            skip[path] = <span class="hljs-keyword">struct</span>&#123;&#125;&#123;&#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Context)</span></span> &#123;<br>        <span class="hljs-comment">// Start timer</span><br>        start := time.Now()<br>        path := c.Request.URL.Path<br>        raw := c.Request.URL.RawQuery<br><br>        <span class="hljs-comment">// Process request</span><br>        c.Next()<br><br>        <span class="hljs-comment">// Log only when path is not being skipped</span><br>        <span class="hljs-keyword">if</span> _, ok := skip[path]; !ok &#123;<br>            param := LogFormatterParams&#123;<br>                Request: c.Request,<br>                isTerm:  isTerm,<br>                Keys:    c.Keys,<br>            &#125;<br><br>            <span class="hljs-comment">// Stop timer</span><br>            param.TimeStamp = time.Now()<br>            param.Latency = param.TimeStamp.Sub(start)<br><br>            param.ClientIP = c.ClientIP()<br>            param.Method = c.Request.Method<br>            param.StatusCode = c.Writer.Status()<br>            param.ErrorMessage = c.Errors.ByType(ErrorTypePrivate).String()<br><br>            param.BodySize = c.Writer.Size()<br><br>            <span class="hljs-keyword">if</span> raw != <span class="hljs-string">&quot;&quot;</span> &#123;<br>                path = path + <span class="hljs-string">&quot;?&quot;</span> + raw<br>            &#125;<br><br>            param.Path = path<br><br>            fmt.Fprint(out, formatter(param))<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="Build-a-single-binary-with-templates"><a href="#Build-a-single-binary-with-templates" class="headerlink" title="Build a single binary with templates"></a>Build a single binary with templates</h1><p>See a complete example in the <a target="_blank" rel="noopener" href="https://github.com/gin-gonic/examples/tree/master/assets-in-binary">https://github.com/gin-gonic/examples/tree/master/assets-in-binary</a> directory.</p>
<h1 id="http2-server-push"><a href="#http2-server-push" class="headerlink" title="http2 server push"></a>http2 server push</h1><p>https on port 8080</p>
<h1 id="goæœåŠ¡è¦ä¸è¦é…nginxå‰ç«¯"><a href="#goæœåŠ¡è¦ä¸è¦é…nginxå‰ç«¯" class="headerlink" title="goæœåŠ¡è¦ä¸è¦é…nginxå‰ç«¯"></a>goæœåŠ¡è¦ä¸è¦é…nginxå‰ç«¯</h1><hr>
<p>å‚è€ƒé˜…è¯»:</p>
<ol>
<li><a href="">Ginçš„è·¯ç”±ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«?</a></li>
</ol>
<hr>
<p>å‚è€ƒèµ„æ–™:</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://straysh.github.life/2020/03/08/BlowFish-Gin%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" title="BlowFish_Ginæºç é˜…è¯»" target="_blank" rel="external">https://straysh.github.life/2020/03/08/BlowFish-Gin%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CNåè®®</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://hexo.straysh.com" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://hexo.straysh.com" target="_blank"><span class="text-dark">Straysh</span><small class="ml-1x">é‡ç”Ÿç¨‹åºçŒ¿</small></a></h3>
        <div>é‡ç”Ÿç¨‹åºçŒ¿ &amp; çŒ«å¥´ã€‚</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2020/03/10/BlowFish-https-ssl/" title="BlowFish_https_ssl"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;ä¸Šä¸€ç¯‡</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2020/03/01/Golang-%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/" title="Golang_æ±‡ç¼–åŸºç¡€"><span>ä¸‹ä¸€ç¯‡&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="æ–‡ç« ç›®å½•" role="button">
        <span>[&nbsp;</span><span>æ–‡ç« ç›®å½•</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/straysh" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://weibo.com/u/1689171115" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2022 straysh.com ç‰ˆæƒæ‰€æœ‰ã€‚ICPè¯ï¼šé„‚ICPå¤‡2021016952å·-1<!--Straysh-->
        
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æœªå‘½å)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




<!--   
    
    <script defer>
    var disqus_config = function () {
        
            this.page.url = 'https://straysh.github.life/2020/03/08/BlowFish-Gin%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/';
        
        this.page.identifier = 'BlowFish-Ginæºç é˜…è¯»';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'straysh' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

-->


<!--  <script src="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>-->
  <script src="/js/jquery.fancybox.min.js"></script>
  <script>
  //åˆ©ç”¨ FancyBox å®ç°ç‚¹å‡»å›¾ç‰‡æ”¾å¤§
  $(document).ready(function() {
    // $('article img').not('[hidden]').not('.panel-body img').each(function() {
    //   var $image = $(this);
    //   var imageCaption = $image.attr('alt');
    //   var $imageWrapLink = $image.parent('a');
    //   if ($imageWrapLink.length < 1) {
    //     var src = this.getAttribute('src');
    //     var idx = src.lastIndexOf('?');
    //     if (idx != -1) {
    //       src = src.substring(0, idx);
    //     }
    //     $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
    //   }
    //   $imageWrapLink.attr('data-fancybox', 'images');
    //   if (imageCaption) {
    //     $imageWrapLink.attr('data-caption', imageCaption);
    //   }
    // });
    // $().fancybox({
    //   selector: '[data-fancybox="images"]',
    //   hash: false,
    //   loop: false,
    // });

    $('[data-fancybox]').fancybox({
      // afterShow :function() {
      //   $('.fancybox-button--zoom').click();
      // }
    });
  });
  </script>






</body>
</html>
