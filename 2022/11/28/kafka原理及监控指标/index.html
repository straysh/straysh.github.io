<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" />
  
  
  <title>kafka原理及监控指标 | Hexo</title>
  <meta name="description" content="文章来源：InnoDB Page Merging and Page Splitting Kafka是什么？Kafka是分布式、高吞吐、可扩展的实时数据流平台。 Kafka广泛使用于日志收集、监控数据聚合、流式数据处理、在线和离线分析等大数据领域，已成为大数据生态中不可或缺的部分。 Producer：通过push模式向Kafka Broker发送消息。发送的消息可以是网站的页面访问、服务器日志，也可">
<meta property="og:type" content="article">
<meta property="og:title" content="kafka原理及监控指标">
<meta property="og:url" content="https://straysh.github.life/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/index.html">
<meta property="og:site_name" content="Straysh的小院">
<meta property="og:description" content="文章来源：InnoDB Page Merging and Page Splitting Kafka是什么？Kafka是分布式、高吞吐、可扩展的实时数据流平台。 Kafka广泛使用于日志收集、监控数据聚合、流式数据处理、在线和离线分析等大数据领域，已成为大数据生态中不可或缺的部分。 Producer：通过push模式向Kafka Broker发送消息。发送的消息可以是网站的页面访问、服务器日志，也可">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://straysh.github.life/images/kafka/kafka%E7%94%9F%E6%80%8101.png">
<meta property="og:image" content="https://straysh.github.life/images/kafka/kafka%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B501.png">
<meta property="og:image" content="https://straysh.github.life/images/kafka/metric_producer.png">
<meta property="og:image" content="https://straysh.github.life/images/kafka/metric_broker01.png">
<meta property="og:image" content="https://straysh.github.life/images/kafka/metric_broker02.png">
<meta property="og:image" content="https://straysh.github.life/images/kafka/metric_broker03.png">
<meta property="og:image" content="https://straysh.github.life/images/kafka/metric_consumer01.png">
<meta property="og:image" content="https://straysh.github.life/images/kafka/metric_zookeeper01.png">
<meta property="article:published_time" content="2022-11-28T04:36:07.000Z">
<meta property="article:modified_time" content="2022-11-28T05:26:49.888Z">
<meta property="article:author" content="Straysh">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Translation">
<meta property="article:tag" content="Kafka">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://straysh.github.life/images/kafka/kafka%E7%94%9F%E6%80%8101.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://straysh.github.life/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Straysh的小院" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
  
  
    <link href="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
  
  
<meta name="generator" content="Hexo 5.4.1"></head>


<body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" style="background-image: url(/images/left_images/2.jpg);" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent" style="height:100%;background-color: rgba(0,0,0,0.7);">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://hexo.straysh.com" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Straysh</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">野生程序猿</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">书单</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/straysh" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://weibo.com/u/1689171115" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">

    
      <ul class="sidebar-nav motion-element" style="text-align:center; opacity: 1; display: block; transform: translateX(0px);">
        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
          文章目录
        </li>
        <li class="sidebar-nav-overview" data-target="site-overview-wrap">
          系统目录
        </li>
      </ul>
      <section class="site-overview-wrap sidebar-panel" style="opacity: 0; display: none;">
        
          <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>妳是风中的叶，风起而走，我想去追，怎么抓的住？</p>
            </div>
        </div>
    </div>
</div>

        
          
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E6%96%87/">博文</a><span class="category-list-count">103</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">笔记</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%AE%B0/">杂记</a><span class="category-list-count">6</span></li></ul>
    </div>
  </div>


        
          
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/" rel="tag">Apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Banbrick/" rel="tag">Banbrick</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a><span class="tag-list-count">25</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/R/" rel="tag">R</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVN/" rel="tag">SVN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sphinx/" rel="tag">Sphinx</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translation/" rel="tag">Translation</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Yii/" rel="tag">Yii</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82/" rel="tag">杂</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B1%87%E7%BC%96/" rel="tag">汇编</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


        
          
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 13.67px;">Algorithm</a> <a href="/tags/Apache/" style="font-size: 13px;">Apache</a> <a href="/tags/Banbrick/" style="font-size: 13.33px;">Banbrick</a> <a href="/tags/Docker/" style="font-size: 13.22px;">Docker</a> <a href="/tags/Golang/" style="font-size: 14px;">Golang</a> <a href="/tags/Javascript/" style="font-size: 13.56px;">Javascript</a> <a href="/tags/Kafka/" style="font-size: 13px;">Kafka</a> <a href="/tags/Linux/" style="font-size: 13.78px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 13.67px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 13px;">Mysql</a> <a href="/tags/Nginx/" style="font-size: 13.11px;">Nginx</a> <a href="/tags/Nodejs/" style="font-size: 13px;">Nodejs</a> <a href="/tags/PHP/" style="font-size: 13.89px;">PHP</a> <a href="/tags/R/" style="font-size: 13.11px;">R</a> <a href="/tags/Redis/" style="font-size: 13.11px;">Redis</a> <a href="/tags/SVN/" style="font-size: 13px;">SVN</a> <a href="/tags/Sphinx/" style="font-size: 13.33px;">Sphinx</a> <a href="/tags/Translation/" style="font-size: 13.89px;">Translation</a> <a href="/tags/Yii/" style="font-size: 13.11px;">Yii</a> <a href="/tags/%E6%9D%82/" style="font-size: 13.44px;">杂</a> <a href="/tags/%E6%B1%87%E7%BC%96/" style="font-size: 13px;">汇编</a>
    </div>
  </div>

        
          
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">十月 2013</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


        
          
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">博文</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">笔记</a>
              </p>
              <p class="item-title">
                <a href="/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/" class="title">kafka原理及监控指标</a>
              </p>
              <p class="item-date">
                <time datetime="2022-11-28T04:36:07.000Z" itemprop="datePublished">2022-11-28</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">博文</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">笔记</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/14/%E4%BD%BF%E7%94%A8Go%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6/" class="title">使用Go操作文件</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-14T12:11:25.000Z" itemprop="datePublished">2022-03-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">博文</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/13/Docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C/" class="title">Docker容器网络</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-13T04:10:09.000Z" itemprop="datePublished">2022-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">博文</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">笔记</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/13/Iptables%E5%92%8C%E5%AE%B9%E5%99%A8/" class="title">Iptables和容器</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-13T03:01:46.000Z" itemprop="datePublished">2022-03-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%8D%9A%E6%96%87/">博文</a>
              </p>
              <p class="item-title">
                <a href="/2022/03/12/Linux%E7%BD%91%E6%A1%A5%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/" class="title">Linux网桥工作原理</a>
              </p>
              <p class="item-date">
                <time datetime="2022-03-12T10:02:29.000Z" itemprop="datePublished">2022-03-12</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

        
      </section>

      <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active" style="opacity: 1; display: block;">
        <nav id="toc" class="article-toc">
          <h3 class="toc-title">文章目录</h3>
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">Kafka是什么？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">Kafka的特点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BC%98%E5%8A%BF"><span class="toc-number">2.1.</span> <span class="toc-text">1. 优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.</span> <span class="toc-text">2. 需要注意的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E7%BB%8F%E5%85%B8%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.</span> <span class="toc-text">Kafka经典使用场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text">Kafka核心概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">Kafka监控指标参考</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Metrics-%E9%87%87%E9%9B%86"><span class="toc-number">5.1.</span> <span class="toc-text">Metrics 采集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Producer%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.1.</span> <span class="toc-text">1. Producer指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Broder%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.2.</span> <span class="toc-text">2. Broder指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Consumer%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.3.</span> <span class="toc-text">3. Consumer指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Zookeeper%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.4.</span> <span class="toc-text">4. Zookeeper指标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka%E7%9B%91%E6%8E%A7%E5%A4%A7%E7%9B%98"><span class="toc-number">5.2.</span> <span class="toc-text">Kafka监控大盘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Producer"><span class="toc-number">5.2.1.</span> <span class="toc-text">1. Producer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Broker"><span class="toc-number">5.2.2.</span> <span class="toc-text">2. Broker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Broker-JVM"><span class="toc-number">5.2.3.</span> <span class="toc-text">3. Broker JVM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Consumer"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">4. Consumer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Zookeeper"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">5. Zookeeper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka-%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99"><span class="toc-number">5.3.</span> <span class="toc-text">Kafka 告警规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Producer-1"><span class="toc-number">5.3.1.</span> <span class="toc-text">1. Producer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Broker-1"><span class="toc-number">5.3.2.</span> <span class="toc-text">2. Broker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Broker-JVM-1"><span class="toc-number">5.3.3.</span> <span class="toc-text">3. Broker JVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Consumer-1"><span class="toc-number">5.3.4.</span> <span class="toc-text">4. Consumer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Zookeeper-1"><span class="toc-number">5.3.5.</span> <span class="toc-text">5. Zookeeper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E5%85%B8%E5%9E%8B%E9%97%AE%E9%A2%98%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%85%B6%E6%8E%92%E6%9F%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">Kafka典型问题场景及其排查&#x2F;解决方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Topic%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E6%85%A2%EF%BC%8C%E5%B9%B6%E5%8F%91%E6%80%A7%E8%83%BD%E4%BD%8E"><span class="toc-number">6.1.</span> <span class="toc-text">1. Topic消息发送慢，并发性能低</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Topic%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B"><span class="toc-number">6.2.</span> <span class="toc-text">2. Topic消息积压</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E5%BB%BAPrometheus%E7%9B%91%E6%8E%A7Kafka%E7%9A%84%E7%97%9B%E7%82%B9"><span class="toc-number">6.3.</span> <span class="toc-text">3. 自建Prometheus监控Kafka的痛点</span></a></li></ol></li></ol>
        </nav>
      </section>
    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">Kafka是什么？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">Kafka的特点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BC%98%E5%8A%BF"><span class="toc-number">2.1.</span> <span class="toc-text">1. 优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.</span> <span class="toc-text">2. 需要注意的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E7%BB%8F%E5%85%B8%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.</span> <span class="toc-text">Kafka经典使用场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text">Kafka核心概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">Kafka监控指标参考</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Metrics-%E9%87%87%E9%9B%86"><span class="toc-number">5.1.</span> <span class="toc-text">Metrics 采集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Producer%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.1.</span> <span class="toc-text">1. Producer指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Broder%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.2.</span> <span class="toc-text">2. Broder指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Consumer%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.3.</span> <span class="toc-text">3. Consumer指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Zookeeper%E6%8C%87%E6%A0%87"><span class="toc-number">5.1.4.</span> <span class="toc-text">4. Zookeeper指标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka%E7%9B%91%E6%8E%A7%E5%A4%A7%E7%9B%98"><span class="toc-number">5.2.</span> <span class="toc-text">Kafka监控大盘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Producer"><span class="toc-number">5.2.1.</span> <span class="toc-text">1. Producer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Broker"><span class="toc-number">5.2.2.</span> <span class="toc-text">2. Broker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Broker-JVM"><span class="toc-number">5.2.3.</span> <span class="toc-text">3. Broker JVM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Consumer"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">4. Consumer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Zookeeper"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">5. Zookeeper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka-%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99"><span class="toc-number">5.3.</span> <span class="toc-text">Kafka 告警规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Producer-1"><span class="toc-number">5.3.1.</span> <span class="toc-text">1. Producer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Broker-1"><span class="toc-number">5.3.2.</span> <span class="toc-text">2. Broker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Broker-JVM-1"><span class="toc-number">5.3.3.</span> <span class="toc-text">3. Broker JVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Consumer-1"><span class="toc-number">5.3.4.</span> <span class="toc-text">4. Consumer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Zookeeper-1"><span class="toc-number">5.3.5.</span> <span class="toc-text">5. Zookeeper</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E5%85%B8%E5%9E%8B%E9%97%AE%E9%A2%98%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%85%B6%E6%8E%92%E6%9F%A5-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">Kafka典型问题场景及其排查&#x2F;解决方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Topic%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E6%85%A2%EF%BC%8C%E5%B9%B6%E5%8F%91%E6%80%A7%E8%83%BD%E4%BD%8E"><span class="toc-number">6.1.</span> <span class="toc-text">1. Topic消息发送慢，并发性能低</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Topic%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B"><span class="toc-number">6.2.</span> <span class="toc-text">2. Topic消息积压</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E5%BB%BAPrometheus%E7%9B%91%E6%8E%A7Kafka%E7%9A%84%E7%97%9B%E7%82%B9"><span class="toc-number">6.3.</span> <span class="toc-text">3. 自建Prometheus监控Kafka的痛点</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-kafka原理及监控指标" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      <span style="color:#008e59;">[译]</span>kafka原理及监控指标
    </h1>
  


      
      <div class="article-meta">
        
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/" class="article-date">
	  <time datetime="2022-11-28T04:36:07.000Z" itemprop="datePublished">2022-11-28</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E5%8D%9A%E6%96%87/">博文</a>►<a class="article-category-link" href="/categories/%E5%8D%9A%E6%96%87/%E7%AC%94%E8%AE%B0/">笔记</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/Kafka/" rel="tag">Kafka</a>, <a class="article-tag-link-link" href="/tags/Linux/" rel="tag">Linux</a>, <a class="article-tag-link-link" href="/tags/Translation/" rel="tag">Translation</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>文章来源：<a target="_blank" rel="noopener" href="https://www.percona.com/blog/2017/04/10/innodb-page-merging-and-page-splitting/">InnoDB Page Merging and Page Splitting</a></p>
<h1 id="Kafka是什么？"><a href="#Kafka是什么？" class="headerlink" title="Kafka是什么？"></a>Kafka是什么？</h1><p>Kafka是分布式、高吞吐、可扩展的实时数据流平台。</p>
<p>Kafka广泛使用于日志收集、监控数据聚合、流式数据处理、在线和离线分析等大数据领域，已成为大数据生态中不可或缺的部分。<br><img src="/images/kafka/kafka%E7%94%9F%E6%80%8101.png"></p>
<p>Producer：通过push模式向Kafka Broker发送消息。发送的消息可以是网站的页面访问、服务器日志，也可以是CPU和内存相关的系统资源信息。</p>
<p>Kafka Broker：用于存储消息的服务。Kafka Broker支持水平扩展。Kafka Broker节点的数量越多，集群的吞吐率(?)越高。</p>
<p>Group：通过pull模式从Kafka Broker订阅并消费消息。</p>
<p>Zookeeper：管理集群的配置、选举领导（Leader）分区，并且在Group发生变化时，进行负载均衡。</p>
<h1 id="Kafka的特点"><a href="#Kafka的特点" class="headerlink" title="Kafka的特点"></a>Kafka的特点</h1><h2 id="1-优势"><a href="#1-优势" class="headerlink" title="1. 优势"></a>1. 优势</h2><ol>
<li>通信模式：支持队列和发布/订阅两种通信模式。(?)</li>
<li>高吞吐量、低延迟：在叫廉价的硬件上，Kafka也能做到每秒处理几十万条消息，延迟最低只有几毫秒。</li>
<li>持久性：Kafka可以将消息持久化到普通磁盘。</li>
<li>可扩展性：Kafka集群支持热扩展，可以动态向集群添加新节点。</li>
<li>容错性：允许集群中节点失败（若副本数量为n，则允许n-1个节点失败）。</li>
</ol>
<h2 id="2-需要注意的问题"><a href="#2-需要注意的问题" class="headerlink" title="2. 需要注意的问题"></a>2. 需要注意的问题</h2><ol>
<li><code>Topic/Partition</code>过多，导致性能急速下降：Kafka <code>Topic/Partition</code>过多（如，对于普通磁盘，单机超过500个Topic/Partition），会导致存储碎片化，负载会发生明显彪高现象，Topic/Partition越多，则负载越高，发送消息响应时间越长。</li>
<li>消息丢失：以下2种使用不当的场景，可能导致消息丢失，应根据业务场景避免。<ul>
<li>生产消息：如果ack!=all或消息副本数不大于1，则Kafka Broker机器越长宕机时，可能导致消息丢失。</li>
<li>消费消息：消费端在未完全处理完消息时即提交offset，则在消费端异常时，可能导致部分消息丢失。</li>
</ul>
</li>
<li>重复消费：生产者可能由于某种原因（如网络抖动或Kafka Broker宕机）没有接收到Kafka Broker的成功确认，然后重复发送消息，最终导致消费者接收到多个相同的业务消息。次场景需要消费者支持消息幂等性来解决。</li>
<li>消息乱序：Kafka只能保证同一分区内的消息有序，不同分区之间的消息不能保证有序。</li>
<li>不支持事务。</li>
</ol>
<h1 id="Kafka经典使用场景"><a href="#Kafka经典使用场景" class="headerlink" title="Kafka经典使用场景"></a>Kafka经典使用场景</h1><ul>
<li>大数据领域：网站行为分析、日志聚合、应用监控、流式数据处理、在线和离线数据分析等。</li>
<li>数据集成：将消息导入MaxCompute、OSS、RDS、Hadoop、HBase等离线数据仓库。</li>
<li>流式计算：与StreamCompute、E-MapReduce、Spark、Storm等流式计算引擎集成。</li>
</ul>
<h1 id="Kafka核心概念"><a href="#Kafka核心概念" class="headerlink" title="Kafka核心概念"></a>Kafka核心概念</h1><p><img src="/images/kafka/kafka%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B501.png"></p>
<ul>
<li>Broker：一个 Kafka 服务端节点。</li>
<li>集群（Cluster）：由多个 Broker 组成的集合。</li>
<li>消息（Message）：也叫 Record，Kafka 中信息传递的载体。消息可以是网站的页面访问、服务器的日志，也可以是和 CPU、内存相关的系统资源信息，但对于消息队列 Kafka 版，消息就是一个字节数组。</li>
<li>Producer：向 Kafka 发送消息的应用。</li>
<li>Consumer：从 Kafka 接收消息的应用。<br>消费者组（Consumer Group）：一组具有相同 Group ID 的 Consumer。当一个 Topic 被同一个 Group 的多个 Consumer 消费时，每一条消息都只会被投递到一个 Consumer，实现消费的负载均衡。通过 Group，您可以确保一个 Topic 的消息被并行消费，提高 Kafka 的吞吐量。</li>
<li>主题（Topic）：消息的主题，用于分类消息。在每个 Broker 上都可以创建多个 Topic。</li>
<li>副本（Replica）：每一个分区都有多个副本。当主分区（Leader）故障的时候会选择一个备分区（Follower）上位，成为 Leader。在 Kafka 中默认副本的最大数量是 10 个，且副本的数量不能大于 Broker 的数量，Follower 和 Leader 是在不同的机器，同一机器对同一个分区也只可能存放一个副本。</li>
<li>分区（Partition）：一个有序不变的消息序列，用于存储消息。一个 Topic 由一个或多个分区组成，每个分区中的消息存储于一个或多个 Broker 上。在一个分区中消息的顺序就是 Producer 发送消息的顺序。</li>
<li>位点（Offset）：分区中每条消息的位置信息，是一个单调递增且不变的值。</li>
<li>消费位点：分区被当前 Consumer 消费了的消息的最大位点。</li>
<li>堆积量：当前分区下的消息堆积总量，即最大位点减去消费位点的值。堆积量是一个关键指标，如果发现堆积量较大，则 Consumer 可能产生了阻塞，或者消费速度跟不上生产速度。此时需要分析 Consumer 的运行状况，尽力提升消费速度。可以清除所有堆积消息，从最大位点开始消费，或按时间点进行位点重置。</li>
<li>重平衡（Rebalance）：消费者组内某个消费者实例挂掉后，其他消费者实例自动重新分配订阅主题分区的过程。Rebalance 是 Kafka 消费者端实现高可用的重要手段。</li>
<li>Zookeeper：Kafka 集群依赖 Zookeeper 来保存集群的的元信息，以保证系统的可用性。</li>
</ul>
<h1 id="Kafka监控指标参考"><a href="#Kafka监控指标参考" class="headerlink" title="Kafka监控指标参考"></a>Kafka监控指标参考</h1><p>结合 Kafka 的体系架构和使用场景，我们从 Metrics 采集、监控大盘、告警指标等3方面定义了 Kafka Metric 监控的参考模型。</p>
<h2 id="Metrics-采集"><a href="#Metrics-采集" class="headerlink" title="Metrics 采集"></a>Metrics 采集</h2><h3 id="1-Producer指标"><a href="#1-Producer指标" class="headerlink" title="1. Producer指标"></a>1. Producer指标</h3><p><img src="/images/kafka/metric_producer.png"></p>
<h3 id="2-Broder指标"><a href="#2-Broder指标" class="headerlink" title="2. Broder指标"></a>2. Broder指标</h3><p><img src="/images/kafka/metric_broker01.png"></p>
<p><img src="/images/kafka/metric_broker02.png"></p>
<p><img src="/images/kafka/metric_broker03.png"></p>
<h3 id="3-Consumer指标"><a href="#3-Consumer指标" class="headerlink" title="3. Consumer指标"></a>3. Consumer指标</h3><p><img src="/images/kafka/metric_consumer01.png"></p>
<h3 id="4-Zookeeper指标"><a href="#4-Zookeeper指标" class="headerlink" title="4. Zookeeper指标"></a>4. Zookeeper指标</h3><p><img src="/images/kafka/metric_zookeeper01.png"></p>
<h2 id="Kafka监控大盘"><a href="#Kafka监控大盘" class="headerlink" title="Kafka监控大盘"></a>Kafka监控大盘</h2><h3 id="1-Producer"><a href="#1-Producer" class="headerlink" title="1. Producer"></a>1. Producer</h3><ul>
<li>topic 消息生产量随时间的变化：便于我们快速确定流量来源，并为基础设施的变更配置提供依据。</li>
<li>请求/响应速率随时间的变化：密切关注峰值和下降对于确保连续服务可用性至关重要。</li>
<li>请求平均延迟随时间的变化：由于延迟与吞吐量有很强的相关性，观察此变化，有助于我们判断是否需要修改 batch.size 参数。</li>
<li>IO 等待随时间的变化：如果我们发现等待时间过长，就意味着生产者无法足够快地获取所需的数据。</li>
</ul>
<h3 id="2-Broker"><a href="#2-Broker" class="headerlink" title="2. Broker"></a>2. Broker</h3><ul>
<li>存在失效副本的分区数量的变化：如果此指标突增，则很可能某个 Broker 发生了异常。</li>
<li>ISR 数量变化：除 Broker 或 Partition 数量变化会触发 ISR 数量变化外，其它情况下的当前指标变化都需要我们注意。</li>
<li>有效 Broker 数量变化。</li>
<li>有效 Controller 数量变化。</li>
<li>离线分区数的变化：此指标大于 0，则意味着这些数量的分区不可用，该分区的消费者和生产者都将被阻塞。</li>
<li>Leader 选举速率和耗时的变化：发生选举，则意味着某个 Leader 的丢失；耗时过长，则会导致此期间消息无法接收生产者消息和消费者的请求。</li>
<li>请求耗时：通常该值应相当稳定，波动很小。</li>
<li>网络流量：提供潜在瓶颈所在位置的信息，为我们判断是否启用消息的端到端压缩提供依据。</li>
<li>生产/拉取 purgatory 消息数量：通过观察 purgatory 中消息数量，有助于我们确定消息生产或拉取耗时长的原因。</li>
</ul>
<h3 id="3-Broker-JVM"><a href="#3-Broker-JVM" class="headerlink" title="3. Broker JVM"></a>3. Broker JVM</h3><p>Full GC 频率和耗时：GC 频率高或耗时长，都对 Broker 性能有重大影响。据此，我们可以判断是否需要对内存进行扩容。</p>
<h4 id="4-Consumer"><a href="#4-Consumer" class="headerlink" title="4. Consumer"></a>4. Consumer</h4><ul>
<li>group 消费延迟数量的变化：该指标越大，则消息堆积越多。</li>
<li>消费流量的变化：显示消费消息的网络流量/消息流量大小变化。</li>
<li>拉取数据速率的变化：消费者是否健康的重要指标。</li>
</ul>
<h4 id="5-Zookeeper"><a href="#5-Zookeeper" class="headerlink" title="5. Zookeeper"></a>5. Zookeeper</h4><ul>
<li>待处理的请求数的变化。</li>
<li>平均请求响应耗时的变化：如果耗时突增，则可能导致整个 Kafka 集群的协调机制受阻。</li>
<li>客户端连接数的变化：连接数的突变，通常伴随着 Broker 的加入、退出或丢失。</li>
<li>打开的文件句柄数和剩余数的变化：如果剩余数不足，则可能导致 Broker 无法连接到 Zookeeper。</li>
<li>同步请求 pending 数量的变化。</li>
</ul>
<h2 id="Kafka-告警规则"><a href="#Kafka-告警规则" class="headerlink" title="Kafka 告警规则"></a>Kafka 告警规则</h2><h3 id="1-Producer-1"><a href="#1-Producer-1" class="headerlink" title="1. Producer"></a>1. Producer</h3><ul>
<li>发送失败消息数：当前发送失败的消息达到一定数量时告警。</li>
<li>发送重试消息数：当单位时间内发送重试的消息数量达到阀值时告警。</li>
<li>发送耗时长：发送耗时大于 x 毫秒。</li>
</ul>
<h3 id="2-Broker-1"><a href="#2-Broker-1" class="headerlink" title="2. Broker"></a>2. Broker</h3><ul>
<li>Controller 正常：有效 Controller 数量不为 1。</li>
<li>无离线分区：离线分区数大于 0。</li>
<li>无 UnClean Leader 选举：Unclean Leader 选举速率大于 0。</li>
<li>Broker 不可用：有效 Broker 数量减少。</li>
<li>ISR 收缩：Topic 分区的 ISR 数量小于 n。</li>
<li>分区不可用：Topic 分区处于 Under Replicated 状态。</li>
<li>Topic/分区容量：Topic/分区数量大于 n。</li>
<li>实例消息流入/出量：当前实例的流量超过或低于某个阀值时告警。</li>
<li>Topic 消息流入/出量：当前某个 Topic 的流量超过或低于指定阀值时告警。</li>
<li>磁盘容量：磁盘使用率大于 x%（参考值：85%）。</li>
<li>CPU 使用率：大于 80%。</li>
</ul>
<h3 id="3-Broker-JVM-1"><a href="#3-Broker-JVM-1" class="headerlink" title="3. Broker JVM"></a>3. Broker JVM</h3><p>FullGC 频率：对频繁的 FGC 告警。</p>
<h3 id="4-Consumer-1"><a href="#4-Consumer-1" class="headerlink" title="4. Consumer"></a>4. Consumer</h3><p>消息堆积：group 消费延迟数量大于 n（根据业务流量，适当配置 n 的大小）。</p>
<h3 id="5-Zookeeper-1"><a href="#5-Zookeeper-1" class="headerlink" title="5. Zookeeper"></a>5. Zookeeper</h3><p>同步请求pending数量大于n。</p>
<h1 id="Kafka典型问题场景及其排查-解决方法"><a href="#Kafka典型问题场景及其排查-解决方法" class="headerlink" title="Kafka典型问题场景及其排查/解决方法"></a>Kafka典型问题场景及其排查/解决方法</h1><h2 id="1-Topic消息发送慢，并发性能低"><a href="#1-Topic消息发送慢，并发性能低" class="headerlink" title="1. Topic消息发送慢，并发性能低"></a>1. Topic消息发送慢，并发性能低</h2><p>现象：某个或某几个Topic的消息并发性能低。在指标上直接体现为Producer的平均请求延迟大、平均生产吞吐量小。</p>
<p>问题原因：</p>
<ul>
<li>网络带宽不足，导致IO等待。</li>
<li>消息未压缩，导致网络流量超负荷。</li>
<li>消息未批量发送，或批量阈值配置不当，导致发送速率慢。</li>
<li>Topic分区数量不足，导致Broker接收消息积压。</li>
<li>Broker磁盘性能低，导致磁盘同步慢。</li>
<li>Broker分区数量过多，导致碎片化，度盘读写过载。</li>
</ul>
<p>排查/解决方法：</p>
<ul>
<li>确认 Producer 的“平均 I/O 等待时间”指标是否符合预期或有陡增？以便确认 Producer 到 Broker 之间的网络带宽是否满足业务流量要求？如果不满足，则需要硬件资源扩容。</li>
<li>确认 Producer 的“平均压缩率指标”，确保压缩率符合预期？如果压缩过低，则需要 Producer 端进行排查、修正。</li>
<li>确认 Producer 的“平均请求包大小”是否过小？如果是的话，则需要考虑加大 Producer 发送消息的 batchsize，同时调整 linger.ms 的阀值，以避免请求消息碎片化。</li>
<li>查看 Topic 分区数，分区数较小时，考虑增加分区数，以水平扩展 Broker 的并发接收消息容量。</li>
<li>确认 Broker 磁盘 IO 使用率是否在安全范围内？如果使用率已经较高，则考虑水平扩容 Broker 数量以分担磁盘压力，或升级磁盘为 SSD 以提升 IO 性能。</li>
<li>确认 Broker 的 CPU 使用率是否在安全范围内？如果使用率已经较高，则考虑垂直或水平扩容 Broker，同时考虑增加 Topic 分区数，以提升 Topic 并发接收消息能力。</li>
<li>查看集群的总分区数和单个 Broker 的分区数量，确保在规划的容量范围内。否则应考虑水平扩容 Broker 数量，以避免碎片化磁盘读写导致的性能下降。</li>
</ul>
<h2 id="2-Topic消息积压"><a href="#2-Topic消息积压" class="headerlink" title="2. Topic消息积压"></a>2. Topic消息积压</h2><p>现象：某个或某几个 Topic 的消息堆积持续增加。在指标上直接体现为 group 消费延迟数量持续增加。</p>
<p>问题原因：</p>
<ul>
<li>Producer生产消息流量增大。</li>
<li>Consumer由于业务变化导致消费延迟增加。</li>
<li>Consumer数量不足。</li>
<li>Consumer数量频繁变化导致Group不断在做重平衡（Rebalance）。</li>
<li>Broker未收到Consumer消费确认消息。</li>
</ul>
<p>解决方法：</p>
<ul>
<li>确认 Producer 的“消息生产量”指标是否有明显增加？如果有显示增加，则我们需要对应增加消费者数量。</li>
<li>确认 Consumer 的“消息消费流量”指标是否明显下降？如果有显示下降，则说明消费者的业务处理耗时增加，我们需要确认业务消耗，或增加消费者数量。</li>
<li>通过 Kafka Broker 提供的命令，确认 Topic 对应的 Consumer 数量与实际的 Consumer 数量是否一致？如果不一致，则说明某些 Consumer 未正确连接到 Broker，需要排查 Consumer 是否正常运行。</li>
<li>观察 Consumer 的数量是否频繁变化而触发反复再平衡（Rebalance），如果是，则我们需要排查确认各个 Consumer 是否正常运行。</li>
<li>由于网络或其它原因，可能导致 Consumer 与 Broker 之间的连接不稳定，Consumer 能持续消费消息，但 Broker 却始终认为消息未确认，导致消费位点不变。此时可能需要确认 Consumer 与 Broker 之间的网络稳定性、甚至重启 Consumer。</li>
</ul>
<h2 id="3-自建Prometheus监控Kafka的痛点"><a href="#3-自建Prometheus监控Kafka的痛点" class="headerlink" title="3. 自建Prometheus监控Kafka的痛点"></a>3. 自建Prometheus监控Kafka的痛点</h2><ul>
<li>由于安全、组织管理等因素，用户业务通常部署在多个相互隔离的 VPC，需要在多个 VPC 内都重复、独立部署 Prometheus，导致部署和运维成本高。</li>
<li>每套完整的自建观测系统都需要安装并配置 Prometheus、Grafana、AlertManager 等，过程复杂、实施周期长。</li>
<li>开源 Kafka JMX Agent 在某些场景下占用 CPU 高，对自建 Kafka 业务有一定干扰。</li>
<li>对于阿里云消息队列 Kafka 版（简称阿里云 Kafka），自建 Prometheus 无法监控到，导致无法实现一站式、全局视角的监控建设。</li>
<li>对于部署在 ECS 上的自建 Kafka，自建 Prometheus 缺少与阿里云 ECS 无缝集成的服务发现（ServiceDiscovery）机制，无法根据 ECS 标签来灵活定义抓取 targets。如果自行实现类似功能，则需要使用 GOlang 语言开发代码（调用阿里云 ECS POP 接口）、集成进开源 Prometheus 代码、编译打包后部署，实现门槛高、过程复杂、版本升级困难。</li>
<li>开源 Grafana Kafka 大盘不够专业，缺少结合 Kafka 原理/特征和最佳实践进行深入优化。</li>
<li>缺少 Kafka 告警指标模板，需要用户自行研究、配置告警规则，工作量大，且很可能缺少 Kafka 领域的专业技术沉淀。</li>
</ul>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://straysh.github.life/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/" title="kafka原理及监控指标" target="_blank" rel="external">https://straysh.github.life/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://hexo.straysh.com" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://hexo.straysh.com" target="_blank"><span class="text-dark">Straysh</span><small class="ml-1x">野生程序猿</small></a></h3>
        <div>野生程序猿 &amp; 猫奴。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    
    <li class="next">
      <a href="/2022/03/14/%E4%BD%BF%E7%94%A8Go%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6/" title="使用Go操作文件"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">
        <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/straysh" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://weibo.com/u/1689171115" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2022 straysh.com 版权所有。ICP证：鄂ICP备2021016952号-1<!--Straysh-->
        
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>

  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




<!--   
    
    <script defer>
    var disqus_config = function () {
        
            this.page.url = 'https://straysh.github.life/2022/11/28/kafka%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/';
        
        this.page.identifier = 'kafka原理及监控指标';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'straysh' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

-->


<!--  <script src="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>-->
  <script src="/js/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    // $('article img').not('[hidden]').not('.panel-body img').each(function() {
    //   var $image = $(this);
    //   var imageCaption = $image.attr('alt');
    //   var $imageWrapLink = $image.parent('a');
    //   if ($imageWrapLink.length < 1) {
    //     var src = this.getAttribute('src');
    //     var idx = src.lastIndexOf('?');
    //     if (idx != -1) {
    //       src = src.substring(0, idx);
    //     }
    //     $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
    //   }
    //   $imageWrapLink.attr('data-fancybox', 'images');
    //   if (imageCaption) {
    //     $imageWrapLink.attr('data-caption', imageCaption);
    //   }
    // });
    // $().fancybox({
    //   selector: '[data-fancybox="images"]',
    //   hash: false,
    //   loop: false,
    // });

    $('[data-fancybox]').fancybox({
      // afterShow :function() {
      //   $('.fancybox-button--zoom').click();
      // }
    });
  });
  </script>






</body>
</html>
